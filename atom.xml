<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Animatious ä¸€èµ·åŠ¨ç”»å¼€æºç»„]]></title>
  <subtitle><![CDATA[æˆ‘ä»¬æ˜¯ä¸€èµ·åŠ¨ç”»å¼€æºç»„Animatiousã€‚æˆ‘ä»¬è‡´åŠ›äºæˆä¸ºä¸­å›½æœ€é¡¶å°–çš„åŠ¨æ•ˆå¼€æºå›¢é˜Ÿã€‚]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://anius.io/"/>
  <updated>2015-12-03T03:21:32.000Z</updated>
  <id>http://anius.io/</id>
  
  <author>
    <name><![CDATA[Animatious]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Epic-Black-Friday-Deals æ•ˆæœçš„å‰ç«¯æŠ€æœ¯å®ç°]]></title>
    <link href="http://anius.io/2015/11/28/epicBlackFridayDeals%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0/"/>
    <id>http://anius.io/2015/11/28/epicBlackFridayDealså‰ç«¯å®ç°/</id>
    <published>2015-11-28T13:25:40.000Z</published>
    <updated>2015-12-03T03:21:32.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è¿™æ˜¯ä¸€ä¸ªé€šè¿‡ web æŠ€æœ¯å®ç°çš„æ•ˆæœæ¼”ç¤º demo ã€‚</p>
<p>åŸè®¾è®¡é“¾æ¥ï¼š <a href="https://dribbble.com/shots/2372734-Epic-Black-Friday-Deals" target="_blank" rel="external">Epic-Black-Friday-Deals</a></p>
<p>åŸæ•ˆæœå›¾ï¼š</p>
<p><img width="400px" height="300px" src="https://d13yacurqjgara.cloudfront.net/users/107759/screenshots/2372734/ink2.gif" alt="Ink2"></p>
<p>Demo é“¾æ¥ï¼š <a href="https://chemzqm.github.io/dribbble-effects/friday.html" target="_blank" rel="external">https://chemzqm.github.io/dribbble-effects/friday.html</a></p>
<p>æ³¨ï¼šä½¿ç”¨ safari ä¿å­˜åˆ°æ¡Œé¢æµè§ˆæ•ˆæœæ›´ä½³ã€‚</p>
<p>æ•´ä¸ªæ•ˆæœåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å®ç°ï¼Œä¸ŠåŠéƒ¨åˆ†é€šè¿‡ canvas ä¸æ–­ç»˜åˆ¶å®ç°ï¼Œä¸‹åŠéƒ¨åˆ†ä½¿ç”¨äº† css çš„ transform å’Œ transition æ¥å®ç°ã€‚ ä¸‹é¢æ˜¯è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="åŸºäº_canvas_å®ç°çš„ä¸ŠåŠéƒ¨åˆ†åŠ¨ç”»">åŸºäº canvas å®ç°çš„ä¸ŠåŠéƒ¨åˆ†åŠ¨ç”»</h2><h3 id="å…³äºcanvas">å…³äºcanvas</h3><p>canvas æ˜¯ä½¿ç”¨ javascript è¿›è¡Œç»˜å›¾çš„åŸºæœ¬ API, å®ƒæœ¬èº«åªæä¾›äº†åŸºç¡€çš„ç”»å›¾ API ï¼ˆä¾‹å¦‚ç›´çº¿ã€å¼§çº¿ã€æ›²çº¿ã€çŸ©å½¢ã€å¡«å……ç­‰ï¼‰ï¼Œé€šè¿‡å­¦ä¹ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial" target="_blank" rel="external">MDNæä¾›çš„æ•™ç¨‹</a>, ä¸€ä¸ªå…·å¤‡ javascript åŸºæœ¬çŸ¥è¯†çš„å¼€å‘è€…å¯ä»¥å¾ˆå¿«æŒæ¡ã€‚</p>
<p>canvas å¹¶ä¸æä¾›åŠ¨ç”»ï¼Œäº‹ä»¶ç­‰æ›´é«˜å±‚çš„ APIï¼Œæ‰€ä»¥éœ€è¦ç›¸åº”åŠŸèƒ½éƒ½éœ€è¦è‡ªè¡Œè®¡ç®—ï¼Œæˆ–è€…å€ŸåŠ©å…¶å®ƒåº“æ¥å®ç°ã€‚</p>
<p>å°½ç®¡æŠ½è±¡æ€§å¾ˆä½ï¼ˆæˆ–è€…è¯´éå¸¸åº•å±‚ï¼‰ä½†æ˜¯ç›¸åº”çš„å¥½å¤„æ˜¯å¯å¡‘æ€§æ¯”è¾ƒå¥½ï¼Œå› ä¸ºå¼€å‘è€…å¯ä»¥ç²¾ç¡®çš„æ§åˆ¶æ¯ä¸€ä¸ªç»†èŠ‚å¦‚ä½•å®Œæˆã€‚</p>
<h3 id="canvas_åŠ¨ç”»å®ç°">canvas åŠ¨ç”»å®ç°</h3><p>canvas æœ¬èº«æ˜¯é™æ€çš„ï¼Œå¹¶ä¸æä¾›åŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ© API <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" target="_blank" rel="external">requestAnimationFrame</a>ï¼Œ é€šè¿‡é‡å¤çš„è°ƒç”¨è¿™ä¸ª API ï¼Œ ä¸æ–­çš„æ¸…ç©ºç”»å¸ƒï¼Œå¹¶å€ŸåŠ©å…¶è¿”å›çš„ timestamp æ—¶é—´æˆ³è®¡ç®—ç»˜åˆ¶æ‰€éœ€çš„å‚æ•°å€¼ï¼Œå°±å¯ä»¥å®ç°åŠ¨ç”»æ•ˆæœäº†ï¼Œ ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> raf = <span class="built_in">window</span>.requestAnimationFrame</span><br><span class="line"><span class="keyword">var</span> start</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!start) start = timestamp</span><br><span class="line">	<span class="comment">//é€šè¿‡æŒç»­æ—¶é—´ä¸åŒé‡ç»˜</span></span><br><span class="line">	drawImage(timestamp - start)</span><br><span class="line">	raf(animate)</span><br><span class="line">&#125;</span><br><span class="line">raf(animate)</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ä½ ä¹Ÿèƒ½ç”¨ setInterval è¿™æ ·çš„ API å®ç°ï¼Œä½†æ˜¯è¿™ä¹ˆåšæ€§èƒ½å¤ªå·®ï¼Œæ¯”å¦‚å½“å‰é¡µé¢éšè—çš„æ—¶å€™ requestAnimationFrame æ˜¯ä¸ä¼šè§¦å‘è°ƒç”¨çš„ï¼Œè¿™æ ·å°±èŠ‚çœäº†å®¢æˆ·ç«¯çš„èµ„æºã€‚</p>
<h3 id="å®ç°ç¼“åŠ¨æ•ˆæœ">å®ç°ç¼“åŠ¨æ•ˆæœ</h3><p>ç¼“åŠ¨æ•ˆæœå¯ä»¥è®©ä½ çš„åŠ¨ç”»æ›´æŸ”å’Œè‡ªç„¶ï¼Œ<a href="http://easings.net/zh-cn" target="_blank" rel="external">easings.net</a>ä¸Šå¯ä»¥çœ‹åˆ°å·²ç»å‘½åçš„ç¼“åŠ¨å‡½æ•°ï¼Œå…¶å®è´¨å°±æ˜¯æŠŠä¸€ä¸ª 0 åˆ° 1 ä¹‹é—´çš„å€¼è¿›è¡Œè½¬åŒ–ã€‚ <a href="https://github.com/component/ease/blob/master/index.js" target="_blank" rel="external">component/ease</a> æ˜¯ä¸€ä¸ªå®ç°äº†ç¼“åŠ¨å‡½æ•°çš„ javascript åº“ï¼Œæˆ‘ä»¬æ‹¿å®ƒçš„ä¸€ä¸ªå‡½æ•° <code>inQuad</code> ä¸¾ä¾‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inQuad</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> duration = <span class="number">600</span> <span class="comment">//åŠ¨ç”»æŒç»­ 600 ms</span></span><br><span class="line"><span class="keyword">var</span> raf = <span class="built_in">window</span>.requestAnimationFrame</span><br><span class="line"><span class="keyword">var</span> start</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!start) start = timestamp</span><br><span class="line">	<span class="keyword">var</span> percent = (timestamp - start)/duration</span><br><span class="line">	<span class="comment">// è½¬åŒ–ä¸ºç¼“åŠ¨åçš„å€¼</span></span><br><span class="line">	percent = inQuad(percent)</span><br><span class="line">	drawImage(percent)</span><br><span class="line">	raf(animate)</span><br><span class="line">&#125;</span><br><span class="line">raf(animate)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬çš„ <code>drawImage</code>æ¥æ”¶åˆ°çš„å°±æ˜¯ç¼“åŠ¨åçš„ç™¾åˆ†æ¯”äº†ã€‚</p>
<p>å°½ç®¡ <code>drawImage</code> æ¥æ”¶åˆ°äº†ç™¾åˆ†æ¯”ï¼Œä½†æ˜¯å…·ä½“çš„å€¼å¾ˆæ˜¯éœ€è¦è‡ªå·±è®¡ç®—ï¼Œå¦‚æœä½ æƒ³çœäº‹å¯ä»¥å€ŸåŠ© <a href="https://github.com/component/tween" target="_blank" rel="external">component/tween</a> ä¹‹ç±»çš„åº“æ¥å¸®ä½ è®¡ç®—å±æ€§å€¼ï¼Œäº‹å®ä¸Šåé¢è¦è®²åˆ°çš„æ—¥æœŸé€‰æ‹©çš„æ»‘åŠ¨æ•ˆæœå°±æ˜¯å€ŸåŠ© tween æ¥å®ç°çš„.</p>
<h2 id="keyframe(å…³é”®å¸§)_çš„å®ç°">keyframe(å…³é”®å¸§) çš„å®ç°</h2><p>keyframeï¼ˆå…³é”®å¸§ï¼‰æ˜¯ä¸€ç§å¯¹åŠ¨ç”»æ§åˆ¶éå¸¸æœ‰ç”¨çš„æŠ½è±¡ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªç”»ä¸€ä¸ªåœˆçš„èµ·å§‹å’Œç»ˆæ­¢å°±å„è‡ªå¯¹åº”ä¸€ä¸ª keyframeï¼Œcss animation å°±æ˜¯é€šè¿‡æ§åˆ¶ keyframe æ¥å®ç°åŠ¨ç”»çš„ APIã€‚ canvas ä¹Ÿæœ‰ç±»ä¼¼çš„åº“æ¥å®ç° keyframeï¼Œä¾‹å¦‚ <a href="https://github.com/jeremyckahn/rekapi" target="_blank" rel="external">rekapi</a>ã€‚ å› ä¸ºè¿™æ¬¡çš„åŠ¨ç”»å¹¶ä¸éœ€è¦ playback æ”¯æŒï¼ˆæˆ–è€…è¯´æˆ‘æ¯”è¾ƒæ‡’ï¼‰ï¼Œæ‰€ä»¥è¿™æ¬¡åªæ˜¯ç®€å•çš„é€šè¿‡çŠ¶æ€æ¥å®ç°äº†ä¸åŒæ•ˆæœçš„åˆ‡æ¢ï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">View</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//è´Ÿè´£åœ†åœˆçš„ç»˜åˆ¶</span></span><br><span class="line">	<span class="keyword">this</span>.circle = <span class="keyword">new</span> Circle(<span class="keyword">this</span>)</span><br><span class="line">	<span class="comment">//è´Ÿè´£ä¸­é—´å›¾æ ‡ç»˜åˆ¶</span></span><br><span class="line">	<span class="keyword">this</span>.icon = <span class="keyword">new</span> Icon(<span class="keyword">this</span>)</span><br><span class="line">	<span class="comment">//è´Ÿè´£æ—¶é—´æ–‡æœ¬çš„ç»˜åˆ¶</span></span><br><span class="line">	<span class="keyword">this</span>.time = <span class="keyword">new</span> Time(<span class="keyword">this</span>)</span><br><span class="line">	<span class="keyword">this</span>.stat = <span class="string">'stopped'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å±•å¼€çŠ¶æ€</span></span><br><span class="line">View.prototype.pend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.stat = <span class="string">'pending'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸­é—´å¯¹å‹¾æ•ˆæœ</span></span><br><span class="line">View.prototype.check= <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.stat = <span class="string">'checking'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‡ç½®ä¸ºå±•å¼€çŠ¶æ€</span></span><br><span class="line">View.prototype.reset = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.stat = <span class="string">'reseting'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸»ç»˜åˆ¶å‡½æ•°</span></span><br><span class="line">View.prototype.draw = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.circle.draw()</span><br><span class="line">	<span class="keyword">this</span>.time.draw()</span><br><span class="line">	<span class="keyword">this</span>.icon.draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¯ä¸ªå­æ¨¡å—é€šè¿‡åˆ¤å®š view çš„ stat ç»˜åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Circle</span>(<span class="params">view</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.view = view</span><br><span class="line">&#125;</span><br><span class="line">Circle.prototype.draw = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> stat = <span class="keyword">this</span>.view.stat</span><br><span class="line">	<span class="keyword">switch</span> (stat) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'pending'</span>:</span><br><span class="line">			<span class="keyword">this</span>.pend()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'checking'</span>:</span><br><span class="line">			<span class="keyword">this</span>.check()</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'reseting'</span>:</span><br><span class="line">			<span class="keyword">this</span>.reset()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// time æ¨¡å—å’Œ icon æ¨¡å—åŒä¸Š</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç§å†™æ³•æ¯”è¾ƒæ–¹ä¾¿çœäº‹ï¼Œä½†æ˜¯æŠ½è±¡æ€§æ¯”è¾ƒå·®ï¼Œå»ºè®®éœ€è¦çµæ´»æ§åˆ¶çš„è¯è¿˜æ˜¯æ‰¾ä¸€ä¸ªé€‚åˆçš„åº“æ¥è¾…åŠ©ã€‚</p>
<h2 id="åŠ¨ç”»æµç¨‹æ§åˆ¶">åŠ¨ç”»æµç¨‹æ§åˆ¶</h2><p>å› ä¸ºæ²¡æœ‰å®ç° keyframe ï¼Œæ‰€ä»¥æµç¨‹æ§åˆ¶ï¼ˆä¾‹å¦‚å–æ¶ˆåŠ¨ç”»å’ŒåŠ¨ç”»è¿ç»­ï¼‰ä¹Ÿå¾—è‡ªå·±æ¥å®ç°äº†ã€‚ å¯é€‰çš„åŠæ³•æœ‰ callback å›è°ƒï¼Œäº‹ä»¶ï¼ŒPromiseç­‰ï¼Œè¿™æ¬¡ä½¿ç”¨äº† Promise å®ç°ï¼Œå› ä¸ºä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€æ´ï¼Œè€Œä¸”å¯ä»¥å¾ˆå®¹æ˜“å®ç°å–æ¶ˆæ“ä½œã€‚</p>
<p>é€šè¿‡è®© Promise reject æ¥å–æ¶ˆåŸæ¥åŠ¨ç”»æµç¨‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">View.prototype.cancel = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.promise = <span class="keyword">this</span>.promise || <span class="built_in">Promise</span>.resolve(<span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">this</span>.canceled = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.promise.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å½“å‰ promise å·²ç»æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    self.canceled = <span class="literal">false</span></span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// reject è¡¨æ˜æˆåŠŸç»“æŸ</span></span><br><span class="line">    self.canceled = <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">View.prototype.animate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> duration = <span class="keyword">this</span>.duration</span><br><span class="line">  <span class="keyword">var</span> start</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">var</span> promise = <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// raf è°ƒç”¨çš„ç»˜åˆ¶ä¸»è¿›ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// transform é‡ç½®</span></span><br><span class="line">      <span class="comment">// å› ä¸ºä½¿ç”¨äº† https://github.com/component/autoscale-canvas/blob/master/index.js é€šè¿‡ scale æ”¯æŒ Retinaï¼Œ</span></span><br><span class="line">      <span class="comment">// æ‰€ä»¥è¿™é‡Œä¸èƒ½ç®€å•çš„æŠŠ scale è®¾ä¸º 1</span></span><br><span class="line">      self.ctx.setTransform(<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span> ,<span class="number">0</span> ,<span class="number">0</span> ,<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span> ,<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="comment">// æ¸…ç©ºç”»å¸ƒ</span></span><br><span class="line">      self.ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, self.width, self.height)</span><br><span class="line">      <span class="comment">// åœæ­¢åŠ¨ç”»å¹¶ä¸” reject</span></span><br><span class="line">      <span class="keyword">if</span> (self.canceled === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!start) start = timestamp</span><br><span class="line">      <span class="keyword">var</span> d = timestamp - start</span><br><span class="line">      <span class="comment">// å›ç€ä¸åŒæ¨¡å—</span></span><br><span class="line">      self.draw()</span><br><span class="line">      <span class="comment">// æˆåŠŸç»“æŸ</span></span><br><span class="line">      <span class="keyword">if</span> (d &gt; duration) &#123;</span><br><span class="line">        <span class="keyword">return</span> resolve()</span><br><span class="line">      &#125;</span><br><span class="line">      raf(step)</span><br><span class="line">    &#125;</span><br><span class="line">    raf(step)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨ <code>view.cancel()</code> å°±å¯ä»¥å–æ¶ˆåŸæ¥çš„æµç¨‹äº†ã€‚</p>
<p><a href="https://github.com/chemzqm/dribbble-effects/blob/master/lib/friday/index.js" target="_blank" rel="external">viewæ¨¡å—</a> çš„ <code>cancel</code> <code>pend</code> <code>reset</code> å’Œ <code>check</code> æ–¹æ³•éƒ½è¿”å›äº† promise å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬éœ€è¦å¼€å§‹æ–°çš„æµç¨‹å°±å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å…ˆå–æ¶ˆå½“å‰åŠ¨ç”»</span></span><br><span class="line">view.cancel()</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åªæœ‰å½“å‰æ˜¯ checked å®ŒæˆçŠ¶æ€æ‰èµ° reset æµç¨‹</span></span><br><span class="line">  <span class="keyword">if</span> (view.checked) &#123;</span><br><span class="line">    <span class="keyword">return</span> view.reset().then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// æš‚åœä¸€ä¸‹å†å¼€å§‹å±•å¼€</span></span><br><span class="line">      <span class="keyword">return</span> view.wait(<span class="number">300</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view.pend()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> view.check()</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å› ä¸ºé€šè¿‡ fail æ¥ç»ˆæ­¢åŠ¨ç”»ï¼Œä¸æ•è·ä¼šæŠ¥é”™</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="å…·ä½“æ•ˆæœå®ç°">å…·ä½“æ•ˆæœå®ç°</h3><ul>
<li>æ¶ˆé€åœ†åœˆçš„æ®‹ä½™å°¾å·´ï¼šé¦–å…ˆæ˜¯è®¾å®šäº†ä¸€ä¸ªåŒºé—´ï¼Œä¾‹å¦‚ï¼š<code>arr = [1, 2, 2, 1, 1]</code> è¡¨ç¤ºæœ‰ <code>arr.length</code> ä¸ªåŒºé—´ï¼Œæ¯ä¸ªåŒºé—´æœ‰ <code>arr[i]</code> ä¸ªå°¾å·´ï¼Œæ¯æ¬¡å˜æ¢åŒºé—´éƒ½é‡æ–°ç”Ÿæˆå°¾å·´ï¼š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">step_len = arr.length</span><br><span class="line">Circle.prototype.pend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="keyword">this</span>.ctx</span><br><span class="line">  <span class="keyword">var</span> percent = <span class="keyword">this</span>.view.percent</span><br><span class="line">  <span class="keyword">var</span> step = <span class="built_in">Math</span>.floor(percent*step_len)</span><br><span class="line">  <span class="comment">// step è½¬å˜ï¼Œç”Ÿæˆæ–°çš„ tail</span></span><br><span class="line">  <span class="keyword">if</span> (step &gt; <span class="keyword">this</span>.step) &#123;</span><br><span class="line">    <span class="keyword">this</span>.createTails()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.step = step</span><br><span class="line">  <span class="comment">// ç»˜åˆ¶æ¯ä¸€ä¸ªtail</span></span><br><span class="line">  <span class="keyword">this</span>.tails.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">tail</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®— tail çš„ percent</span></span><br><span class="line">    <span class="keyword">var</span> p = percent*step_len - step</span><br><span class="line">    <span class="comment">// tail æ ¹æ®è‡ªå·± percent (0 ä¸ºåˆå§‹ 1ä¸ºæ¶ˆå¤±)è¿›è¡Œç»˜åˆ¶</span></span><br><span class="line">    tail.draw(p)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Circle.prototype.createTails = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> n = <span class="keyword">this</span>.step</span><br><span class="line">  <span class="keyword">var</span> num = steps[n]</span><br><span class="line">  <span class="keyword">var</span> tails = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> tail = <span class="keyword">new</span> Tail(<span class="keyword">this</span>, i)</span><br><span class="line">    tails.push(tail)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.tails = tails</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´åŠ¨ç”»çš„è®¡ç®—ï¼Œè¿™é‡Œçš„å±•å¼€å’Œé‡ç½®åŠ¨ç”»æ˜¯ä¸åŒçš„ï¼ˆæš‚å¼€æ—¶åˆ†ç§’çš„åŠ¨ç”»è¦è¿œå¿«ä¸æ—¶ï¼Œé‡ç½®æ—¶æ—¶åˆ†ç§’çš„é€Ÿç‡æ˜¯ç›¸åŒçš„ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸èƒ½ç®€å•çš„ playback äº†ï¼Œé‡ç½®æ—¶åªéœ€è¦ <code>percent*total</code> å°±èƒ½è®¡ç®—å¯¹åº”çš„ååˆ†ç§’ï¼Œå±•å¼€æ—¶éœ€è¦æ ¹æ®ä¸€å¤©çš„ååˆ†ç§’è¿›è¡Œä¸€ç‚¹è®¡ç®—ï¼š<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function pad(<span class="keyword">n</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> ('0' + <span class="literal">String</span>(<span class="keyword">n</span>)).slice(-2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function toHMS(<span class="keyword">n</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">h</span> = Math.<span class="literal">floor</span>(<span class="keyword">n</span>/3600)</span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">m</span> = Math.<span class="literal">floor</span>((<span class="keyword">n</span> - <span class="keyword">h</span>*3600)/60)</span><br><span class="line">  <span class="keyword">var</span> s = Math.<span class="literal">floor</span>(<span class="keyword">n</span>%60)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">h</span>: pad(<span class="keyword">h</span>),</span><br><span class="line">    <span class="keyword">m</span>: pad(<span class="keyword">m</span>),</span><br><span class="line">    s: pad(s)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1å¤©çš„ç§’æ•°</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">total</span> = 24*60*60</span><br><span class="line"><span class="comment">// è·å– hms</span></span><br><span class="line">toHMS(<span class="keyword">n</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å…¶å®è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯å› ä¸ºç§’æ•°å˜åŒ–é£å¿«ï¼Œæœ‰å¯èƒ½ 1/60 ç§’å°±å®Œæˆäº† 0~60 çš„å˜åŒ–, è¿™æ ·å¦‚æœæµè§ˆå™¨æ˜¯ 60hz çš„è¯å°±åªä¼šæ˜¾ç¤ºç›¸å¯¹å›ºå®šçš„ç§’æ•°ï¼Œä¾‹å¦‚ <code>5x</code> (xä¸º0 ~ 9), è§£å†³åŠæ³•å°±æ˜¯è°ƒæ•´ä¸‹åŠ¨ç”»æŒç»­æ—¶é—´ ğŸ˜…</p>
<ul>
<li><p>è®¾ç½®åŠ¨æ€æ–‡æœ¬ã€‚è¿™æ¬¡æœ¬æ¥æ‰“ç®—ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ ProximaNova-Light æ¥æ˜¾ç¤ºæ—¶é—´çš„ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªå­—ä½“çš„æ•°å­—ä¸æ˜¯ç­‰å®½çš„ï¼Œç»“æœå°±æ˜¯æ˜¾ç¤ºåŠ¨ç”»çš„æ—¶å€™æ•°å­—ä¼šä¸€ç›´æŠ–åŠ¨ï¼Œæ”¹ä¸ºç³»ç»Ÿè‡ªå¸¦å­—ä½“ <code>sans-serif</code> <code>Helvetica</code> å°±æ²¡æœ‰è¿™ç§é—®é¢˜ã€‚</p>
</li>
<li><p>å¯¹å‹¾çš„å®ç°ã€‚æœ¬æ¬¡å®ç°æœ€ä¸ºå¤æ‚çš„éƒ¨åˆ†ï¼Œå› ä¸ºæ¶‰åŠè§’åº¦ã€ä½ç½®ã€é•¿åº¦çš„ç²¾ç¡®è®¡ç®—ï¼Œæœ€åä½¿ç”¨äº†é»„é‡‘åˆ†å‰²ï¼Œä¹Ÿå°±æ˜¯å³è¾¹æ¯”å·¦è¾¹ 1.618: 1, ç»“æœæ¯”è¾ƒæ»¡æ„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Icon.prototype.drawCorrect = <span class="function"><span class="keyword">function</span> (<span class="params">p, tx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> l = <span class="number">14</span></span><br><span class="line">  <span class="keyword">var</span> tl = <span class="number">2.618</span>*l</span><br><span class="line">  <span class="keyword">var</span> len = tl*(outBack(p))</span><br><span class="line">  <span class="keyword">var</span> ctx = <span class="keyword">this</span>.ctx</span><br><span class="line">  <span class="keyword">var</span> x = <span class="keyword">this</span>.x</span><br><span class="line">  <span class="keyword">var</span> y = <span class="keyword">this</span>.y</span><br><span class="line">  <span class="comment">// èµ·å§‹ x y</span></span><br><span class="line">  <span class="keyword">var</span> sx = x - <span class="number">10</span></span><br><span class="line">  <span class="keyword">var</span> sy = y - <span class="number">3</span></span><br><span class="line">  <span class="keyword">var</span> subtense = <span class="built_in">Math</span>.min(len, l)</span><br><span class="line">  <span class="comment">// ä¸­é—´ç‚¹ x y</span></span><br><span class="line">  <span class="keyword">var</span> mx = sx + subtense*<span class="built_in">Math</span>.cos(<span class="number">45</span>*PI/<span class="number">180</span>)</span><br><span class="line">  <span class="keyword">var</span> my = sy + subtense*<span class="built_in">Math</span>.sin(<span class="number">45</span>*PI/<span class="number">180</span>)</span><br><span class="line">  tx = tx != <span class="literal">null</span> ? tx : - <span class="number">8</span>*(<span class="number">1</span> - outBack(p))</span><br><span class="line">  <span class="comment">// åç§»é‡</span></span><br><span class="line">  ctx.translate(tx, <span class="number">0</span>)</span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.moveTo(sx, sy)</span><br><span class="line">  ctx.lineTo(mx, my)</span><br><span class="line">  <span class="keyword">if</span> (len &gt; l) &#123;</span><br><span class="line">    subtense = len - l</span><br><span class="line">    <span class="comment">// ç»ˆæ­¢ x y</span></span><br><span class="line">    <span class="keyword">var</span> ex = mx + subtense*<span class="built_in">Math</span>.cos(<span class="number">50</span>*PI/<span class="number">180</span>)</span><br><span class="line">    <span class="keyword">var</span> ey = my - subtense*<span class="built_in">Math</span>.sin(<span class="number">50</span>*PI/<span class="number">180</span>)</span><br><span class="line">    ctx.lineTo(ex, ey)</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.stroke()</span><br><span class="line">  <span class="comment">// é‡ç½® transform</span></span><br><span class="line">  ctx.setTransform(<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span> ,<span class="number">0</span> ,<span class="number">0</span> ,<span class="built_in">window</span>.devicePixelRatio || <span class="number">1</span> ,<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡ºå»ä¸€ç‚¹è¿”å›</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outBack</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> s = <span class="number">1.70158</span>;</span><br><span class="line">  <span class="keyword">return</span> --n * n * ((s + <span class="number">1</span>) * n + s) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå‡ ä¸ªç‚¹çš„åæ ‡ä¸ç”¨é‡å¤è®¡ç®—çš„ï¼Œä½†æ˜¯æ¯”è¾ƒå·æ‡’å°±æ²¡æŠ½è±¡å‡ºå»ğŸ™‚</p>
<ul>
<li>åˆ›å»ºé®ç½©ã€‚ä¸ºäº†å®ç°ä¸­é—´å›¾æ ‡çš„è¿›å…¥å’Œé€€å‡ºæ•ˆæœï¼Œæˆ‘åœ¨æ¯æ¬¡åŠ¨ç”»çš„æ—¶å€™éƒ½åœ¨ä¸­é—´å›¾æ ‡çš„å·¦è¾¹æˆ–è€…å³è¾¹åˆ›å»ºäº†ä¸€ä¸ªä¸èƒŒæ™¯è‰²ç›¸åŒçš„çŸ©å½¢åŒºåŸŸï¼Œè¿™æ ·å›¾æ ‡å‡ºå»çš„æ—¶å€™å°±ä¼šè¢«é®ç½©ç›–ä½ï¼Œçœ‹ä¸Šå°±å°±å¥½è±¡å›¾æ ‡æ˜¯åœ¨ä¸‹ä¸€å±‚é€€å‡ºçš„ä¸€æ ·ã€‚(å› ä¸ºcanvas å¹¶æ²¡æœ‰ z-index)</li>
</ul>
<h2 id="åŸºäº_Dom_çš„ä¸‹åŠéƒ¨åˆ†æ—¥æœŸé€‰æ‹©æ¨¡å—">åŸºäº Dom çš„ä¸‹åŠéƒ¨åˆ†æ—¥æœŸé€‰æ‹©æ¨¡å—</h2><h3 id="æ—¥æœŸçŠ¶æ€å˜åŒ–æ—¶é¢œè‰²æ¸å˜">æ—¥æœŸçŠ¶æ€å˜åŒ–æ—¶é¢œè‰²æ¸å˜</h3><p>åªéœ€è¦ç”¨ css ä¸€ä¸ª transion å°±èƒ½å®ç°ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">transition</span>: <span class="tag">color</span> 0<span class="class">.5s</span> <span class="tag">linear</span>;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çŠ¶æ€åˆ‡æ¢æ—¶æ”¹å˜å…ƒç´ çš„ className å°±å¯ä»¥äº†ï¼Œï¼ˆå°æŠ€å·§: classList APIï¼‰</p>
<h3 id="æ—¥æœŸåˆ—è¡¨è§¦æ‘¸æ»šåŠ¨å®ç°">æ—¥æœŸåˆ—è¡¨è§¦æ‘¸æ»šåŠ¨å®ç°</h3><p>é€šè¿‡ä¸æ–­è°ƒæ•´å…ƒç´ çš„ translateX æˆ–è€…æœ‰ translate3d æ—¶è°ƒæ•´ translate3d çš„ x å€¼å®ç°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = el.style</span><br><span class="line"><span class="keyword">if</span> (has3d) &#123;</span><br><span class="line">  s[transform] = <span class="string">'translate3d('</span> + x + <span class="string">'px, 0, 0)'</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  s[transform] = <span class="string">'translateX('</span> + x + <span class="string">'px)'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç›¸å¯¹å¤æ‚çš„ä¸€æ­¥å°±æ˜¯ touchend æ—¶è®¡ç®—ä¹‹ååŠ¨ç”»çš„æŒç»­æ—¶é—´ã€æœ€ç»ˆä½ç½®å’Œç¼“åŠ¨å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡é€Ÿåº¦</span></span><br><span class="line"><span class="keyword">var</span> deceleration = <span class="number">0.0004</span></span><br><span class="line"><span class="comment">// å½“å‰æ»‘åŠ¨é€Ÿåº¦</span></span><br><span class="line"><span class="keyword">var</span> speed = <span class="keyword">this</span>.speed</span><br><span class="line"><span class="keyword">var</span> x = <span class="keyword">this</span>.x</span><br><span class="line"><span class="comment">// é™å®šé€Ÿåº¦</span></span><br><span class="line">speed = <span class="built_in">Math</span>.min(speed, <span class="number">0.6</span>)</span><br><span class="line"><span class="keyword">var</span> minX = - (<span class="keyword">this</span>.total - <span class="keyword">this</span>.count)*width</span><br><span class="line"><span class="comment">// ä¼°ç®—ç»ˆç‚¹</span></span><br><span class="line"><span class="keyword">var</span> destination = x + ( speed * speed ) / ( <span class="number">2</span> * deceleration ) * ( <span class="keyword">this</span>.distance &lt; <span class="number">0</span> ? -<span class="number">1</span> : <span class="number">1</span> )</span><br><span class="line"><span class="comment">// ä¼°ç®—æ—¶é—´</span></span><br><span class="line"><span class="keyword">var</span> duration = speed / deceleration</span><br><span class="line"><span class="keyword">var</span> newX</span><br><span class="line"><span class="keyword">var</span> ease = <span class="string">'out-cube'</span></span><br><span class="line"><span class="comment">// ç»ˆç‚¹è¶…å‡ºå³è¾¹ç•Œ é‡ç®—ç»ˆç‚¹å’Œç¼“åŠ¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> (destination &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  newX = <span class="number">0</span></span><br><span class="line">  ease = <span class="string">'out-back'</span></span><br><span class="line"><span class="comment">// ç»ˆç‚¹å°äºå·¦è¾¹ç•Œ é‡ç®—ç»ˆç‚¹å’Œç¼“åŠ¨å‡½æ•°</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (destination &lt; minX) &#123;</span><br><span class="line">  newX = minX</span><br><span class="line">  ease = <span class="string">'out-back'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¶…å‡ºè¾¹ç•Œçš„è¯é‡ç®—æŒç»­æ—¶é—´</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> newX === <span class="string">'number'</span>) &#123;</span><br><span class="line">  duration = duration*<span class="built_in">Math</span>.abs((newX - x + <span class="number">50</span>)/(destination - x))</span><br><span class="line">  <span class="comment">//duration = Math.max(200, duration)</span></span><br><span class="line">  destination = newX</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½“å‰ç‚¹åœ¨è¾¹ç•Œå¤–ï¼Œå›ºå®šæŒç»­æ—¶é—´å’Œç¼“åŠ¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> (x &gt; <span class="number">0</span> || x &lt; minX) &#123;</span><br><span class="line">  duration = <span class="number">500</span></span><br><span class="line">  ease = <span class="string">'out-circ'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å›ºå®šç»ˆç‚¹ä¸ºå­å…ƒç´ å®½åº¦çš„æ•´æ•°å€</span></span><br><span class="line">destination = <span class="built_in">Math</span>.round(destination/width)*width</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  x: destination,</span><br><span class="line">  duration: duration,</span><br><span class="line">  ease: ease</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®¡ç®—å®ŒæˆåæŠŠç»“æœä¼ é€’ç»™ <code>tween</code> å¯¹è±¡å°±å¯ä»¥å¼€å§‹æ»‘åŠ¨äº†ã€‚</p>
<h3 id="æ—¥æœŸé€‰æ‹©">æ—¥æœŸé€‰æ‹©</h3><p>ç”¨åˆ°äº† <a href="https://github.com/component/events" target="_blank" rel="external">events</a> å®ç°äº‹ä»¶ä»£ç†, ä»¥åŠ<a href="https://github.com/chemzqm/tap-event" target="_blank" rel="external">tap-event</a>å®ç°æ­£ç¡®çš„ tap äº‹ä»¶ ï¼ˆéƒ½æ˜¯éå¸¸å¸¸ç”¨çš„ç§»åŠ¨ç«¯ç»„ä»¶ï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•çš„åˆ¤å®šï¼Œé˜²æ­¢ click å’Œ tap äº‹ä»¶åŒæ—¶è§¦å‘</span></span><br><span class="line"><span class="keyword">var</span> hastouch = <span class="string">'ontouchstart'</span> <span class="keyword">in</span> <span class="built_in">window</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Footer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.events = events(el, <span class="keyword">this</span>)</span><br><span class="line">  <span class="keyword">if</span> (hastouch) &#123;</span><br><span class="line">    <span class="keyword">this</span>.events.bind(<span class="string">'touchstart li'</span>, <span class="string">'ontap'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.events.bind(<span class="string">'click li'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Footer.prototype.onclick = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> li = e.delegateTarget</span><br><span class="line">  <span class="keyword">var</span> children = <span class="keyword">this</span>.el.children</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = children.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (li === children[i]) &#123;</span><br><span class="line">      <span class="comment">// é«˜äº®é€‰ä¸­å…ƒç´ </span></span><br><span class="line">      li.classList.add(<span class="string">'active'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ç§»é™¤å…¶å®ƒå…ƒç´ é«˜äº®</span></span><br><span class="line">      li.classList.remove(<span class="string">'active'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Footer.prototype.ontap = tap(Footer.prototype.onclick)</span><br></pre></td></tr></table></figure>
<h3 id="äº‹ä»¶ä¼ é€’">äº‹ä»¶ä¼ é€’</h3><p>ä½¿ç”¨çš„ <a href="https://github.com/component/emitter" target="_blank" rel="external">component/emitter</a>, å®ƒå®ç°äº†éå¸¸ç®€å•çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆè®¢é˜…å‘å¸ƒæ¨¡å¼ï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Footer</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Emitter(el)</span><br><span class="line"></span><br><span class="line">Footer.prototype.active = <span class="function"><span class="keyword">function</span> (<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.emit(<span class="string">'change'</span>,  index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">View</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> footer = <span class="keyword">this</span>.footer = <span class="keyword">new</span> Footer()</span><br><span class="line">  footer.on(<span class="string">'change'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// active å˜åŒ–çš„äº‹ä»¶ä»£ç†å‡½æ•°</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº† <code>Footer</code> æ¨¡å—å’Œ <code>View</code> æ¨¡å—çš„è§£è€¦åˆ</p>
<h2 id="Q_and_A">Q and A</h2><p>Q: ä¸ºä»€ä¹ˆæ²¡æœ‰æ³¨é‡Š?</p>
<p>A: å®ç°æ¯”è¾ƒä»“ä¿ƒï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯å®é™…ä½¿ç”¨é¡¹ç›®ï¼Œæ‰€ä»¥æ¯”è¾ƒå·æ‡’ï¼Œå…¶å®æˆ‘çš„å¤§éƒ¨åˆ†é¡¹ç›®éƒ½å¾ˆä¸¥è‚ƒï¼Œä¹Ÿæœ‰æ¯”è¾ƒå®Œæ•´çš„æµ‹è¯•å’Œæ³¨é‡Šã€‚</p>
<p>Q: ä¸ºä»€ä¹ˆ ios ä¸Šä¿å­˜ä¸º app åçŠ¶æ€æ æ˜¯ç™½è‰²ï¼Ÿ</p>
<p>A: å› ä¸ºè¿™æ˜¯ ios9 çš„ bugï¼Œ åŸæœ¬å¯ä»¥é€æ˜çš„ï¼Œ <a href="https://forums.developer.apple.com/thread/9819" target="_blank" rel="external">äº†è§£æ›´å¤š</a></p>
<p>Q: ä¸ºä»€ä¹ˆæ‰‹æœºæ¨ªè¿‡æ¥å°±ä¸èƒ½çœ‹äº†ï¼Ÿ</p>
<p>A: å› ä¸ºç°åœ¨safari è¿˜æ²¡æœ‰å®ç°é”å±çš„ API !</p>
<h2 id="æœ€å">æœ€å</h2><p>å®ç° web åŠ¨ç”»è¿˜æœ‰ <a href="https://developer.mozilla.org/en/docs/Web/CSS/animation" target="_blank" rel="external">css animation</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API" target="_blank" rel="external">webgl</a> <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/SVG_animation_with_SMIL" target="_blank" rel="external">svg smil</a> ç­‰æ–¹æ¡ˆï¼Œè¿™æ¬¡å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œä»¥åæœ‰æœºä¼šå†ä¸ºå¤§å®¶ä»‹ç»ã€‚</p>
<p>æˆ–è®¸æ˜¯å› ä¸º web å­˜åœ¨å¾ˆå¤šçš„æŠ€æœ¯æ–¹æ¡ˆä»¥åŠç›¸åº”ç±»åº“ï¼Œå¯¼è‡´å¾ˆå¤šåš web çš„åŒå­¦è§‰å¾—æç‰¹æ•ˆå¾ˆå¤æ‚ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤, åªè¦ä½ äº†è§£äº†å®ƒä»¬åŸºæœ¬ç‰¹ç‚¹å¹¶æŒæ¡åŸºæœ¬æ–¹æ³•ï¼Œå°±è¶³å¤Ÿåšå‡ºä¸é”™çš„æ•ˆæœäº†ï¼Œå†é™„é€ä¸€ä¸ªæ›´ç®€å•çš„ä¾‹å­ï¼š<a href="https://chemzqm.github.io/loadings/" target="_blank" rel="external">canvas loadings</a></p>
<p>å¸Œæœ›æœ¬æ–‡èƒ½å¸®ä½ åšå‡ºæ›´å¥½çš„ web åŠ¨ç”»æ•ˆæœã€‚</p>
<h2 id="å…³äºä½œè€…">å…³äºä½œè€…</h2><p>chemzqm@gmail.com ä¸€ä¸ªä»¥ç®€æ´é«˜æ•ˆä¸ºè¿½æ±‚çš„ Javascript å¼€å‘è€…</p>
<p>Github: <a href="https://github.com/chemzqm" target="_blank" rel="external">https://github.com/chemzqm</a></p>
<p>weibo: <a href="http://weibo.com/chemzqm" target="_blank" rel="external">http://weibo.com/chemzqm</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è¿™æ˜¯ä¸€ä¸ªé€šè¿‡ web æŠ€æœ¯å®ç°çš„æ•ˆæœæ¼”ç¤º demo ã€‚</p>
<p>åŸè®¾è®¡é“¾æ¥ï¼š <a href="https://dribbble.com/shots/2372734-Epic-Black-Friday-Deals" target=]]>
    </summary>
    
      <category term="canvas" scheme="http://anius.io/tags/canvas/"/>
    
      <category term="web" scheme="http://anius.io/tags/web/"/>
    
      <category term="ä»£ç " scheme="http://anius.io/categories/%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SCCatWaitingHUDçš„Objcä»£ç å®ç°]]></title>
    <link href="http://anius.io/2015/11/25/SCCatWaitingHUD/"/>
    <id>http://anius.io/2015/11/25/SCCatWaitingHUD/</id>
    <published>2015-11-25T10:19:49.000Z</published>
    <updated>2015-11-28T13:21:20.000Z</updated>
    <content type="html"><![CDATA[<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è¿™ä¸ªåˆ›æ„å…¶å®æ¥æºäºå¾®åšä¸Š@ç”»æ¸£ç¨‹åºçŒ¿mmoaayè½¬å‘å¹¶è‰¾ç‰¹æˆ‘çš„çš„ä¸€ç»„gifå›¾<br>çœ‹åˆ°å›¾çš„æ—¶å€™ æˆ‘å…ˆå¯¹å›¾å¤§è‡´è¿›è¡Œäº†ç»“æ„å’Œå±‚æ¬¡çš„åŒºåˆ†<br>åœ¨è®¾è®¡ç‰©ä½“åŠ¨æ•ˆçš„æ—¶å€™ï¼Œé¦–å…ˆæ˜¯è¦å¯¹åŠ¨ç”»çš„ä¸åŒå¯¹è±¡è¿›è¡Œæ‹†åˆ†ï¼Œåœ¨è¿™é‡Œï¼Œè€é¼ ï¼ŒçŒ«çœ¼ç›ï¼Œçœ¼çš®ï¼Œä»¥åŠçŒ«è„¸ï¼Œä»–ä»¬å„è‡ªçš„è¡Œä¸ºåˆ†åˆ«æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åˆ†ä¸ºä¸åŒçš„å›¾å±‚ </p>
<p><img src="/img/2015/11/SCCatWaitingHUD/pic1.jpg" alt=""></p>
<p>åœ¨æ•´ä½“åŠ¨ç”»è¿›è¡Œçš„æ—¶å€™ï¼Œä»–ä»¬å„è‡ªçš„layeræ‰€æ‰§è¡Œçš„åŠ¨ç”»æ˜¯ä¸åŒçš„<br>çœ‹èµ·æ¥è¿™ä¸ªæ§ä»¶å¾ˆç®€å•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹å†™å‡ºè¿™æ ·ä¸€ä¸ªæ§ä»¶éœ€è¦æ³¨æ„çš„å…³é”®ç‚¹å§~</p>
<h1 id="åˆ†æ">åˆ†æ</h1><p>å…ˆç¡®è®¤æˆ‘ä»¬è¦åšæˆä»€ä¹ˆæ ·çš„æ§ä»¶  </p>
<h2 id="é¦–å…ˆ_è¿™æ˜¯ä¸€ä¸ªç­‰å¾…åŠ¨ç”»_æ‰€ä»¥åº”è¯¥åšæˆä¸€ä¸ªHUDç±»å‹çš„æ§ä»¶">é¦–å…ˆ è¿™æ˜¯ä¸€ä¸ªç­‰å¾…åŠ¨ç”» æ‰€ä»¥åº”è¯¥åšæˆä¸€ä¸ªHUDç±»å‹çš„æ§ä»¶</h2><p>è¿™æ ·å¯ä»¥åœ¨å½“å‰windowçš„ä¸Šæ–¹å‡ºç°å’Œæ¶ˆå¤±è€Œä¸å½±å“å½“å‰è§†å›¾çš„å±•ç¤º<br>æ‰€ä»¥æˆ‘ä»¬å°±è¦åœ¨åº”ç”¨å½“å‰é»˜è®¤çš„UIWindowä¸Šå†æ·»åŠ ä¸€ä¸ªUIWindow è¿™æ ·å¯ä»¥åœ¨å…¨å±€ä»»ä½•åœ°æ–¹è°ƒç”¨è¿™ä¸ªHUD åŒæ—¶æˆ‘ä»¬çš„HUDä¹Ÿè¦å®ç°å…¨å±€çš„å•ä¾‹æ¨¡å¼  </p>
<h2 id="å…¶æ¬¡æ˜¯åŠ¨ç”»_æœ€åˆçš„åŠ¨ç”»å…¶å®å¹¶ä¸éš¾">å…¶æ¬¡æ˜¯åŠ¨ç”» æœ€åˆçš„åŠ¨ç”»å…¶å®å¹¶ä¸éš¾</h2><p>åªæ˜¯çœ¼ç›å›¾å±‚å’Œè€é¼ å›¾å±‚å›´ç€å„è‡ªçš„ä¸­å¿ƒç‚¹æ—‹è½¬ ä¸”æ‹¥æœ‰ç›¸åŒçš„è¿åŠ¨å‘¨æœŸ è¿™æ ·èƒ½è®©ä»–ä»¬åœ¨ç›¸åŒæ—¶é—´å†…ç§»åŠ¨çš„å¼§åº¦æ˜¯ç›¸åŒçš„ äº§ç”Ÿçœ¼ç›è·Ÿç€è€é¼ èµ°çš„æ„Ÿè§‰</p>
<p><img src="/img/2015/11/SCCatWaitingHUD/circle.png" alt=""></p>
<h2 id="æœ€åæ˜¯çœ¼çš®å’Œçœ¼ç çš„è¿åŠ¨åè°ƒ">æœ€åæ˜¯çœ¼çš®å’Œçœ¼ç çš„è¿åŠ¨åè°ƒ</h2><p>ç”±äºçœ¼ç åšçš„æ˜¯åŒ€é€Ÿåœ†å‘¨è¿åŠ¨ è€Œçœ¼çš®åšçš„æ˜¯ç›´çº¿ç¼©æ”¾è¿åŠ¨ å› æ­¤å¦‚ä½•åè°ƒè¿™ä¸¤è€…çš„è¿åŠ¨æ—¶é—´æ›²çº¿ å†³å®šäº†æœ€åçš„åŠ¨ç”»æ˜¯å¦æµç•…å’Œè‡ªç„¶  </p>
<h3 id="è¿˜æœ‰ä¸€ç‚¹é¢å¤–çš„ä¸´æ—¶äº§ç”Ÿçš„éœ€æ±‚å°±æ˜¯å¯¹æ¨ªå±çš„æ”¯æŒ">è¿˜æœ‰ä¸€ç‚¹é¢å¤–çš„ä¸´æ—¶äº§ç”Ÿçš„éœ€æ±‚å°±æ˜¯å¯¹æ¨ªå±çš„æ”¯æŒ</h3><p>è¿™æ˜¯æˆ‘åœ¨å†™çš„è¿‡ç¨‹ä¸­@sauchyeæå‡ºçš„issueï¼Œæ‰€ä»¥æˆ‘èŠ±äº†ä¸€ä¸ªç‰ˆæœ¬ç”¨æ¥åŠ ä¸Šäº†å¯¹å·¦å³æ¨ªå±çš„æ”¯æŒ</p>
<h1 id="ä»£ç å®ç°">ä»£ç å®ç°</h1><h2 id="UIWindow">UIWindow</h2><p>UIWindow æ˜¯æ¯ä¸€ä¸ªç¨‹åºéƒ½å¿…é¡»åˆ›å»ºçš„æ ¹è§†å›¾ï¼Œå®ƒæ˜¯UIViewçš„å­ç±»ï¼Œä½†æ˜¯åœ°ä½å´åœ¨æ‰€æœ‰çš„UIViewä¹‹ä¸Šã€‚æ¯ä¸€ä¸ªç¨‹åºåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœä½ ä½¿ç”¨äº†interface builderä½œä¸ºå¯åŠ¨ç•Œé¢ï¼Œé‚£ä¹ˆXcodeä¼šè‡ªåŠ¨æŠŠä½ çš„ç¬¬ä¸€ä¸ªControlleræ·»åŠ åˆ°æ ¹windowä¸Šï¼Œå¦‚æœä½ è¦é€šè¿‡ä»£ç åˆå§‹åŒ–Windowï¼Œåˆ™å¿…é¡»è¦åƒç³»ç»Ÿè¦æ±‚çš„è¿™æ ·å£°æ˜ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application willFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line"></span><br><span class="line">   <span class="built_in">UIWindow</span> *window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[[<span class="built_in">UIScreen</span> mainScreen] bounds]];</span><br><span class="line"></span><br><span class="line">   myViewController = [[MyViewController alloc] init];</span><br><span class="line">   window<span class="variable">.rootViewController</span> = myViewController;</span><br><span class="line">   [window makeKeyAndVisible];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨SCCatWaitingHUDä¸­ï¼Œç”±äºéœ€è¦å­˜åœ¨ä¸€ä¸ªä¸å¹²æ‰°åŸæœ‰ç¨‹åºä»£ç é€»è¾‘å’Œè§†å›¾é€»è¾‘çš„Viewï¼Œå› æ­¤æœ€åˆé€‚çš„åŠæ³•å°±æ˜¯å£°æ˜ä¸€ä¸ªç‹¬ç«‹çš„Windowã€‚HUDçš„è¿™ç§ä½¿ç”¨æ¨¡å¼å¯ä»¥å‚è€ƒMBProgressHUDï¼Œå¼€å‘è€…å¯ä»¥åœ¨å…¨å±€ä»»æ„çš„åœ°æ–¹è°ƒç”¨HUDçš„æ˜¾ç¤ºï¼Œç”±äºHUDæ‰€åœ¨çš„Windowå’Œç³»ç»ŸåŸæœ¬çš„Windowç›¸æ¯”levelæ›´é«˜ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸å½±å“åŸæœ‰è§†å›¾çš„æƒ…å†µä¸‹åœ¨ä»»æ„é¡µé¢æ˜¾ç¤ºã€‚</p>
<p>UIWindowçš„ç»“æ„å¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°UIWindowæœ¬èº«å°±æ˜¯ä¸€ä¸ªUIViewã€‚æ¯ä¸ªUIWindowéƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºrootViewControllerçš„å±æ€§ï¼Œè€Œè¿™ä¸ªå±æ€§å°±æ˜¯è¿™ä¸ªwindowå°†ä¼šå‘ˆç°çš„controllerå¯¹è±¡ã€‚</p>
<p><img src="/img/2015/11/SCCatWaitingHUD/window.png" alt=""></p>
<p>Xcode7ä¹‹åï¼Œè‹¹æœè¦æ±‚æ‰€æœ‰çš„UIWindowåœ¨å£°æ˜çš„æ—¶å€™éƒ½éœ€è¦æœ‰ä¸€ä¸ªrootViewControllerï¼Œå³é€šè¿‡ä»£ç å£°æ˜çš„æ—¶å€™ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªrootViewControllerï¼Œç„¶ååœ¨è¿™ä¸ªcontrollerä¹‹ä¸Šæ·»åŠ è¦æ˜¾ç¤ºçš„å†…å®¹ã€‚ä½†æ˜¯ç»è¿‡éªŒè¯ï¼Œåœ¨ç¨‹åºè¿è¡Œä¸­åˆ›å»ºçš„éæ ¹Windowçš„UIWindowï¼Œå¯ä»¥ç›´æ¥å½“åšUIViewæ¥ä½¿ç”¨ï¼Œä»ç„¶ä¸éœ€è¦å¼ºåˆ¶ç»™ä¸€ä¸ªrootViewControllerã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span><span class="variable">.backgroundWindow</span> = [[<span class="built_in">UIWindow</span> alloc]initWithFrame:<span class="keyword">self</span><span class="variable">.frame</span>];</span><br><span class="line">_backgroundWindow<span class="variable">.windowLevel</span> = <span class="built_in">UIWindowLevelStatusBar</span>;</span><br><span class="line">_backgroundWindow<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">_backgroundWindow<span class="variable">.alpha</span> = <span class="number">0.0</span>f;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªHUDçš„ä¸»è¦æ˜¾ç¤ºå¯¹è±¡å°±æ˜¯åä¸º<code>backgroundWindow</code>çš„UIWindowå±æ€§å¯¹è±¡<br>é‚£ä¹ˆæ€ä¹ˆæ§åˆ¶Windowçš„å‡ºç°å’Œæ¶ˆå¤±å‘¢<br>UIWindowæœ‰å‡ ä¸ªæ–¹æ³•:  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)makeKeyWindow;</span><br><span class="line">- (void)makeKeyAndVisible;                             // convenience. most apps <span class="operator"><span class="keyword">call</span> this <span class="keyword">to</span> <span class="keyword">show</span> the <span class="keyword">main</span> window <span class="keyword">and</span> also make it <span class="keyword">key</span>. otherwise <span class="keyword">use</span> <span class="keyword">view</span> hidden property</span></span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬éƒ½æ˜¯ç”¨ä¸Šè¿°ç¬¬äºŒä¸ªæ–¹æ³•æ¥è®©æŒ‡å®šWindowæˆä¸ºkeyWindowå¹¶ä¸”å‡ºç°ã€‚è‡³äºæ€ä¹ˆè®©æŒ‡å®šWindowæ¶ˆå¤±ï¼Œè‹¹æœå¹¶æ²¡æœ‰æä¾›ä¸€äº›ç‰¹åˆ«çš„åŠæ³•ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­æœ‰ç»™å‡ºä¸‹é¢è¿™ç§ç”¨æ³•</p>
<pre><code>_backgroundWindow.hidden = <span class="type">YES</span>;
// <span class="type">According</span> to <span class="type">Apple</span> <span class="type">Doc</span> : <span class="type">This</span> <span class="keyword">is</span> a convenience <span class="keyword">method</span> to make the receiver the main window <span class="keyword">and</span> displays it <span class="keyword">in</span> front <span class="keyword">of</span> other windows at the same window level <span class="keyword">or</span> lower. <span class="type">You</span> can also hide <span class="keyword">and</span> reveal a window <span class="keyword">using</span> the inherited hidden property <span class="keyword">of</span> <span class="type">UIView</span>.
</code></pre><h2 id="Animation">Animation</h2><p>åŠ¨ç”»è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œ<strong>è€é¼ çš„æ—‹è½¬æ˜¯ç»•ç€è‡ªèº«çš„ä¸­å¿ƒç‚¹ï¼Œç„¶è€Œä¸¤ä¸ªçœ¼ç çš„æ—‹è½¬å¹¶ä¸æ˜¯</strong>ã€‚<br>é¦–å…ˆï¼Œæ—‹è½¬åŠ¨ç”»çš„å®ç°æˆ‘ä»¬è‚¯å®šæ˜¯é€šè¿‡<code>CATransform3DRotate</code>ï¼ŒåŸºæœ¬çš„CAAnimationå£°æ˜å¦‚ä¸‹:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> radians(<span class="keyword">float</span> degrees) &#123;</span><br><span class="line">    <span class="keyword">return</span> ( degrees * <span class="number">3.14159265</span> ) / <span class="number">180.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CATransform3D</span> getTransForm3DWithAngle(<span class="built_in">CGFloat</span> angle)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CATransform3D</span>  transform = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line">    transform  = <span class="built_in">CATransform3DRotate</span>(transform, angle, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> transform;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CABasicAnimation</span> *)rotationAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *rotationAnimation;</span><br><span class="line">    rotationAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</span><br><span class="line">    rotationAnimation<span class="variable">.fromValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:getTransForm3DWithAngle(<span class="number">0.0</span>f)];</span><br><span class="line">    rotationAnimation<span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:getTransForm3DWithAngle(radians(<span class="number">180.0</span>f))];</span><br><span class="line">    rotationAnimation<span class="variable">.duration</span> = <span class="keyword">self</span><span class="variable">.animationDuration</span>;</span><br><span class="line">    rotationAnimation<span class="variable">.cumulative</span> = <span class="literal">YES</span>;</span><br><span class="line">    rotationAnimation<span class="variable">.repeatCount</span> = HUGE_VALF;</span><br><span class="line">    rotationAnimation<span class="variable">.removedOnCompletion</span>=<span class="literal">NO</span>;</span><br><span class="line">    rotationAnimation<span class="variable">.fillMode</span>=k<span class="built_in">CAFillModeForwards</span>;</span><br><span class="line">    rotationAnimation<span class="variable">.autoreverses</span> = <span class="literal">NO</span>;</span><br><span class="line">    rotationAnimation<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionLinear</span>];</span><br><span class="line">    <span class="keyword">return</span> rotationAnimation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦æ¥çœ‹çœ‹CALayerçš„å‡ ä¸ªåŸºæœ¬å±æ€§ï¼šframeã€boundsã€positionã€anchorPointã€‚frameå’Œboundséƒ½å¯ä»¥ç”¨UIViewä¸­çš„çŸ¥è¯†å»ç†è§£ï¼Œframeæ˜¯ç›¸å¯¹äºsuperLayerçš„ä½ç½®å’Œå¤§å°ï¼Œè€Œboundsæ˜¯originä¸º(0,0)çš„frameã€‚<br>è€ŒanchorPointåˆ™æ˜¯ä¸€ä¸ªLayerçš„é”šç‚¹ï¼Œç›¸ä¿¡åšè¿‡ä¸€äº›åŠ¨ç”»å¼€å‘æˆ–è€…æ¸¸æˆå¼€å‘çš„åŒå­¦ä»¬éƒ½çŸ¥é“é”šç‚¹çš„ä½œç”¨ã€‚é”šç‚¹ä½œä¸ºLayerå˜æ¢çš„åŸºå‡†ç‚¹ï¼Œå®ƒçš„åæ ‡å€¼ä¸ºç›¸å¯¹äºboundså®½é«˜çš„æ¯”ä¾‹ã€‚åœ¨iOSä¸­ï¼Œå®ƒçš„èµ·å§‹ç‚¹æ˜¯Layerçš„å·¦ä¸Šè§’ï¼Œä¸ºæ ‡å‡†åŸç‚¹(0ï¼Œ0)ï¼Œå³ä¸‹è§’ä¸º(1,1)ï¼Œé»˜è®¤å€¼ä¸ºä¸­å¿ƒç‚¹(0.5,0.5)ï¼›åœ¨MacOSä¸­ï¼Œèµ·å§‹ç‚¹ä¸ºå·¦ä¸‹è§’ï¼Œ(1,1)åœ¨å³ä¸Šè§’ã€‚æ‰€ä»¥é€šè¿‡ä¿®æ”¹é”šç‚¹çš„ç›¸å¯¹ä½ç½®ï¼Œå°±å¯ä»¥è®©æ—‹è½¬çš„è½´å¿ƒå˜æˆæˆ‘ä»¬éœ€è¦çš„ä½ç½®ã€‚  </p>
<p>è¿™é‡Œæœ‰ä¸€å¼ å›¾æ¥è¯´æ˜é”šç‚¹æ˜¯ä»€ä¹ˆã€‚</p>
<p><img src="/img/2015/11/SCCatWaitingHUD/anchorpoint2.jpg" alt=""></p>
<p>å› æ­¤æˆ‘å°è¯•ç€å°†çœ¼ç çš„anchorPointè®¾ç½®ä¸º(1.5,1.5)ï¼Œæ—‹è½¬ä¸­å¿ƒå˜æˆäº†æ¥è¿‘çœ¼ç›ä¸­å¿ƒçš„ç‚¹ã€‚ä½†æ˜¯è¿™æ—¶å€™æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹positionæ¥é…åˆanchorPointçš„æ”¹å˜ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œpositionæ˜¯é”šç‚¹ç›¸å¯¹äºçˆ¶layerçš„åæ ‡å€¼ï¼Œè€ŒanchorPointåˆ™æ˜¯é”šç‚¹ç›¸å¯¹äºè‡ªèº«çš„åæ ‡å€¼ï¼Œä¸¤è€…å…±åŒå†³å®šäº†é”šç‚¹å’Œæ•´ä¸ªLayeræ‰€åœ¨çš„ä½ç½®ã€‚<br>æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è°ƒæ•´çœ¼ç Layerçš„positionï¼Œæ¥å’Œä¹‹å‰è®¾ç½®çš„anchorPointçš„ä½ç½®é‡åˆã€‚</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_rightEye.layer.<span class="built_in">anchor</span>Point = CGPointMake(<span class="number">1.5</span>f, <span class="number">1.5</span>f);</span><br><span class="line">_rightEye.layer.position = CGPointMake(<span class="literal">self</span>.faceView.right - <span class="number">13.5</span>f, <span class="literal">self</span>.faceView.top + width/<span class="number">3.0</span>f + <span class="number">7.5</span>f);</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™ï¼Œä¸Šé¢çš„<code>CAAnimation</code>å°±å¯ä»¥æ­£å¸¸çš„æ·»åŠ åˆ°Layerçš„transformä¸Šå¹¶ä¸”æ‰§è¡Œå‡ºæ¥å•¦ã€‚</p>
<h2 id="çœ¼çš®çš„è¿åŠ¨æ—¶é—´æ›²çº¿">çœ¼çš®çš„è¿åŠ¨æ—¶é—´æ›²çº¿</h2><p>è¿™é‡Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦è®©çœ¼çš®å’Œçœ¼ç çš„è¿åŠ¨è¾¾åˆ°åè°ƒä¸€è‡´ï¼Œä¸ä¼šå‡ºç°ç¿»ç™½çœ¼ä¹Ÿä¸ä¼šå‡ºç°æ–—é¸¡çœ¼ï¼ˆå“ˆå“ˆå“ˆå“ˆï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆåˆ†æå‡ºä¸‹é¢ä¸¤ä¸ªç»“è®º:</p>
<ul>
<li>çœ¼çš®çš„ä¸Šä¸‹è¿åŠ¨å‘¨æœŸå’Œçœ¼ç çš„æ—‹è½¬è¿åŠ¨å‘¨æœŸä¸€è‡´</li>
<li>çœ¼çš®åœ¨ç«–ç›´æ–¹å‘ä¸Šçš„ä½ç§»å’Œçœ¼ç åœ¨ç«–ç›´æ–¹å‘ä¸Šçš„ä½ç§»ä¸€è‡´</li>
<li>çœ¼ç åœ¨åœ†å‘¨åˆ‡çº¿æ–¹å‘çš„çº¿æ€§é€Ÿç‡æ˜¯åŒ€é€Ÿçš„</li>
</ul>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œçœ¼çš®åœ¨ç«–ç›´æ–¹å‘ä¸Šçš„é€Ÿç‡æ›²çº¿å’Œçœ¼ç åœ¨ç«–ç›´æ–¹å‘ä¸Šçš„é€Ÿç‡æ›²çº¿æ˜¯ä¸€è‡´çš„ã€‚æˆ‘ä»¬æ¥åˆ†æçœ¼ç çš„é€Ÿåº¦æ–¹å‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠå‘¨çš„æ—¶é•¿å®šä¸ºå¸¸é‡Tï¼ŒåŠå¾„å®šä¸ºRã€‚åœ¨ä¸‹é¢çš„æ¨å¯¼ä¸­æˆ‘ä¼šå°†<strong>T=2</strong>è¿™ä¸ªæ¡ä»¶å½“åš<strong>å·²çŸ¥æ¡ä»¶</strong>ä»£å…¥ã€‚</p>
<p><img src="/img/2015/11/SCCatWaitingHUD/v.jpg" alt=""></p>
<p>é€šè¿‡å°†é€Ÿåº¦åˆ†è§£æˆæ°´å¹³Xè½´å’Œç«–ç›´Yè½´çš„åˆ†é‡åï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç«–ç›´æ–¹å‘ä¸Šçš„çœ¼ç é€Ÿåº¦çš„é€Ÿåº¦æ›²çº¿ï¼Œå°±æ˜¯ç®€å•çš„<br><img src="/img/2015/11/SCCatWaitingHUD/sinx.jpg" alt="">   </p>
<p>è¿™é‡Œçš„Vyå°±æ˜¯ç«–ç›´é€Ÿåº¦åˆ†é‡ï¼ŒÎ¸æ˜¯tæ—¶åˆ»çš„åœ†å¿ƒè§’ï¼Œç”±äºè¿™é‡Œåšçš„æ˜¯åŒ€é€Ÿåœ†å‘¨è¿åŠ¨ï¼Œå› æ­¤è§’é€Ÿåº¦å’Œçº¿é€Ÿåº¦ä¹Ÿæ˜¯åŒ€é€Ÿçš„ï¼Œå…¬å¼ä¸­çš„Vå³ä¸ºåŒ€é€Ÿçš„çº¿é€Ÿåº¦<br><img src="/img/2015/11/SCCatWaitingHUD/xiansudu.png" alt="">   </p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—å‡ºtæ—¶åˆ»çš„åœ†å¿ƒè§’å…¬å¼ä¸º<br><img src="/img/2015/11/SCCatWaitingHUD/xita.jpg" alt=""></p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¹‹å‰çŠ¯äº†ä¸ªå¤§é”™è¯¯ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰è¯»è€…æ³¨æ„åˆ°ã€‚ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘çš„å…¬å¼é‡Œå°†æ—¶é—´å’Œå¼§åº¦åˆ†å­å’Œåˆ†æ¯çš„ä½ç½®é¢ å€’äº†ï¼Œå¹¶ä¸”æœ€åæ±‚ä½ç§»å…¬å¼çš„æ—¶å€™ï¼Œå¿˜è®°äº†è¿™æ˜¯ä¸ªå˜é€Ÿè¿åŠ¨ã€‚å› æ­¤å¾—å‡ºæ¥çš„ä½ç§»å‡½æ•°æ›²çº¿å¹¶ä¸æ˜¯åƒä¹‹å‰é‚£ä¸ªç‰ˆæœ¬æ‰€å±•ç¤ºçš„ä¸€æ ·ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å°†ä»¥ä¸Šå‡ ä¸ªå…¬å¼åˆå¹¶èµ·æ¥ä¹‹åè·å¾—ä¸€ä¸ªVyçš„å…¬å¼å¦‚ä¸‹<br><img src="/img/2015/11/SCCatWaitingHUD/finalVy.jpg" alt=""></p>
<p>è¿™ä¸ªå‡½æ•°çš„å›¾åƒå¦‚ä¸‹ï¼Œç”±äºRæ²¡æœ‰ç¡®å®šï¼Œæˆ‘åœ¨è¿™é‡Œä½¿å¾—R=5ï¼Œæ¥çœ‹ä¸€ä¸‹æ›²çº¿çš„æ ·å­ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ­£å¼¦æ›²çº¿<br><img src="/img/2015/11/SCCatWaitingHUD/finalVyLine.png" alt=""></p>
<p>è¿™æ—¶å€™ï¼Œç”±äºåŠ é€Ÿåº¦æ˜¯å˜åŒ–çš„ï¼Œé€Ÿåº¦ä¹Ÿæ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸ªéåŒ€å˜é€Ÿè¿åŠ¨ï¼Œå®ƒçš„ä½ç§»æ›²çº¿åªèƒ½é€šè¿‡å¯¹é€Ÿåº¦æ›²çº¿çš„ç§¯åˆ†æ¥æ±‚å¾—ã€‚å› æ­¤æˆ‘ä»¬è¦æ±‚Vyå‡½æ•°åœ¨(0,t)åŒºé—´çš„ç§¯åˆ†ã€‚<br><img src="/img/2015/11/SCCatWaitingHUD/jifen.png" alt=""></p>
<p>è¿™ä¸ªç§¯åˆ†æ±‚å‡ºæ¥å¾—åˆ°çš„ç»“æœå¦‚ä¸‹<br><img src="/img/2015/11/SCCatWaitingHUD/Sfinal.jpg" alt=""></p>
<p>è¿™ä¸ªå°±æ˜¯æœ€åçš„ä½ç§»å…¬å¼ï¼Œå®ƒçš„å‡½æ•°å›¾åƒå¦‚ä¸‹<br><img src="/img/2015/11/SCCatWaitingHUD/SfinalLine.png" alt=""></p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬å¾—å‡ºè¿™ä¸ªå‡½æ•°å›¾åƒçš„ä¸»è¦ç›®æ ‡æ˜¯ç¡®å®šçœ¼çš®çš„ä¸Šä¸‹ç¼©æ”¾åŠ¨ç”»çš„æ—¶é—´æ›²çº¿ï¼Œè¿™ä¸ªæ›²çº¿ä»£è¡¨ç€ä½ç§»å’Œæ—¶é—´çš„å‡½æ•°å…³ç³»ã€‚è¿™æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å›¾åƒå°±æ˜¯æ¥ä¸‹æ¥è¦ç»™çœ¼çš®åŠ ä¸Šçš„ç¼©æ”¾åŠ¨ç”»çš„æ—¶é—´æ›²çº¿äº†ï¼Œæˆ‘æ²¡æœ‰ç”¨ä¸“é—¨çš„ç”»è´å¡å°”æ›²çº¿çš„è½¯ä»¶æ¥ç”»ï¼Œåªæ˜¯æ ¹æ®å‡½æ•°çš„å›¾åƒå¤§è‡´ç”»å‡ºäº†ä¸€ä¸ªè´å¡å°”æ›²çº¿ï¼Œä½œä¸ºäº†ä¸‹é¢è¿™ä¸ªåŠ¨ç”»çš„æ—¶é—´æ›²çº¿</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CAAnimationGroup</span> *)scaleAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çœ¼çš®å’Œçœ¼ç éœ€è¦ç¡®å®šä¸€ä¸ªè¿åŠ¨æ—¶é—´æ›²çº¿</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *scaleAnimation;</span><br><span class="line">    scaleAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</span><br><span class="line">    scaleAnimation<span class="variable">.fromValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DIdentity</span>];</span><br><span class="line">    scaleAnimation<span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DMakeScale</span>(<span class="number">1.0</span>, <span class="number">3.0</span>, <span class="number">1.0</span>)];</span><br><span class="line">    scaleAnimation<span class="variable">.duration</span> = <span class="keyword">self</span><span class="variable">.animationDuration</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.cumulative</span> = <span class="literal">YES</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.repeatCount</span> = <span class="number">1</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.removedOnCompletion</span>= <span class="literal">NO</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.fillMode</span>=k<span class="built_in">CAFillModeForwards</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.autoreverses</span> = <span class="literal">NO</span>;</span><br><span class="line">    scaleAnimation<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithControlPoints:<span class="number">0.2</span>:<span class="number">0.0</span> :<span class="number">0.8</span> :<span class="number">1.0</span>];</span><br><span class="line">    scaleAnimation<span class="variable">.speed</span> = <span class="number">1.0</span>f;</span><br><span class="line">    scaleAnimation<span class="variable">.beginTime</span> = <span class="number">0.0</span>f;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CAAnimationGroup</span> *group = [<span class="built_in">CAAnimationGroup</span> animation];</span><br><span class="line">    group<span class="variable">.duration</span> = <span class="keyword">self</span><span class="variable">.animationDuration</span>;</span><br><span class="line">    group<span class="variable">.repeatCount</span> = HUGE_VALF;</span><br><span class="line">    group<span class="variable">.removedOnCompletion</span>= <span class="literal">NO</span>;</span><br><span class="line">    group<span class="variable">.fillMode</span>=k<span class="built_in">CAFillModeForwards</span>;</span><br><span class="line">    group<span class="variable">.autoreverses</span> = <span class="literal">YES</span>;</span><br><span class="line">    group<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithControlPoints:<span class="number">0.2</span>:<span class="number">0.0</span>:<span class="number">0.8</span> :<span class="number">1.0</span>];</span><br><span class="line">    </span><br><span class="line">    group<span class="variable">.animations</span> = [<span class="built_in">NSArray</span> arrayWithObjects:scaleAnimation, <span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">return</span> group;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥çœ‹åˆ°<code>CAMediaTimingFunction</code>ï¼Œè¿™å°±æ˜¯æ—¶é—´æ›²çº¿çš„ç±»ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šæä¾›è¿™ä¹ˆå‡ ç§ä½ å¸¸ç”¨åˆ°çš„æ—¶é—´æ›²çº¿</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAMediaTimingFunctionLinear</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAMediaTimingFunctionEaseIn</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAMediaTimingFunctionEaseOut</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAMediaTimingFunctionEaseInEaseOut</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br></pre></td></tr></table></figure>
<p>ä»–ä»¬åˆ†åˆ«ä»£è¡¨äº†åŒ€é€Ÿè¿åŠ¨ï¼Œå…ˆå¿«åæ…¢ï¼Œå…ˆæ…¢åå¿«ï¼Œå…ˆå¿«åæ…¢å†å¿«è¿™å››ç§è¿åŠ¨æ—¶é—´æ›²çº¿ã€‚å¦‚æœä½ è¦è‡ªå®šä¹‰æ—¶é—´æ›²çº¿çš„è¯ï¼Œç³»ç»Ÿä¹Ÿæä¾›äº†ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„æ–¹æ³•ï¼Œä½ åªè¦ç¡®å®šæ›²çº¿çš„ä¸¤ä¸ªæ§åˆ¶ç‚¹åæ ‡å³å¯ã€‚è€Œåæ ‡çš„åŸç‚¹ä¸º(0ï¼Œ0)ï¼Œæœ€åæ”¶å°¾çš„ç‚¹åˆ™åœ¨(1,1)ï¼Œæ¨ªè½´ä¸ºæ—¶é—´ï¼Œçºµè½´ä¸ºåŠ¨ç”»çš„æ‰§è¡Œç¨‹åº¦ï¼Œåæ ‡å€¼ä»£è¡¨ç€ç›¸å¯¹æ¯”ä¾‹å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æˆªå–ä¸Šé¢çš„å‡½æ•°å›¾åƒä¸­æ¨ªè½´0åˆ°Tçš„éƒ¨åˆ†ä½œä¸º0åˆ°1çš„æ—¶é—´é•¿åº¦ï¼Œæ¥ç»˜åˆ¶è´å¡å°”æ›²çº¿ã€‚è€Œè¿™é‡Œæˆ‘è®¾ç½®äº†å‰ææ¡ä»¶ä¸ºT=2ï¼Œå› æ­¤åªè¦æˆªå–(0,2)åŒºé—´é‡Œçš„å‡½æ•°æ›²çº¿å°±å¯ä»¥äº†ã€‚</p>
<h2 id="æœ€åæ˜¯ä¸€ç‚¹å¯¹æ¨ªå±çš„æ”¯æŒ">æœ€åæ˜¯ä¸€ç‚¹å¯¹æ¨ªå±çš„æ”¯æŒ</h2><p>ç”±äºæˆ‘ä»¬å®ç°çš„æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„UIWindowï¼Œæ²¡æœ‰æ·»åŠ ViewControllerï¼Œæ‰€ä»¥<strong>ä¸èƒ½</strong>é€šè¿‡ViewControllerä¸‹é¢å‡ ä¸ªæ¶‰åŠåˆ°å±å¹•æ—‹è½¬çš„å›è°ƒæ¥è·å¾—å±å¹•æ–¹å‘çš„å˜åŒ–ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// New Autorotation support.</span></span><br><span class="line">- (BOOL)<span class="function">shouldAutorotate <span class="title">NS_AVAILABLE_IOS</span><span class="params">(<span class="number">6</span>_0)</span> __TVOS_PROHIBITED</span>;</span><br><span class="line">- (UIInterfaceOrientationMask)<span class="function">supportedInterfaceOrientations <span class="title">NS_AVAILABLE_IOS</span><span class="params">(<span class="number">6</span>_0)</span> __TVOS_PROHIBITED</span>;</span><br><span class="line"><span class="comment">// Returns interface orientation masks.</span></span><br><span class="line">- (UIInterfaceOrientation)<span class="function">preferredInterfaceOrientationForPresentation <span class="title">NS_AVAILABLE_IOS</span><span class="params">(<span class="number">6</span>_0)</span> __TVOS_PROHIBITED</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±è¦é€šè¿‡ç›‘å¬ç³»ç»Ÿçš„ä¸€ä¸ªå¹¿æ’­æ¶ˆæ¯æ¥è·å–å±å¹•çŠ¶æ€çš„å˜åŒ–ã€‚</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr_selector">[[NSNotificationCenter defaultCenter]</span> <span class="tag">addObserver</span><span class="pseudo">:self</span> <span class="tag">selector</span>:@<span class="tag">selector</span>(<span class="attribute">statusBarOrientationChange</span>:)  <span class="tag">name</span><span class="pseudo">:UIApplicationDidChangeStatusBarOrientationNotification</span> <span class="tag">object</span><span class="pseudo">:nil</span>];</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¨ªå±åˆ‡æ¢çš„å›è°ƒé‡Œï¼Œæˆ‘è®°å½•äº†å‰ä¸€ä¸ªå±å¹•çŠ¶æ€ï¼Œè·å–åˆ°å½“å‰å±å¹•çŠ¶æ€ï¼Œç„¶ååšäº†ä¸€ä¸ªæ—‹è½¬çš„å˜æ¢ï¼Œè¿™æ ·æ•´ä¸ªHUDå°±ä¼šéšç€å±å¹•æ–¹å‘çš„å˜åŒ–è€Œå˜åŒ–äº†ã€‚è¯¦ç»†çš„å®ç°å¯ä»¥ç›´æ¥çœ‹æºä»£ç ï¼Œè¿™é‡Œå°±ä¸å†è´´å‡ºã€‚</p>
<h1 id="æ•ˆæœ">æ•ˆæœ</h1><p>è¿™ä¸ªå¼€æºæ§ä»¶çš„åŸºæœ¬åŸç†ä¹Ÿå°±è¿™äº›äº†ï¼Œä½ å¯ä»¥åœ¨æˆ‘çš„<a href="https://github.com/SergioChan/SCCatWaitingHUD" target="_blank" rel="external">github</a>ä¸Šcloneä¸‹æºä»£ç æ¥é˜…è¯» :-) ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„å»ºè®®æˆ–è€…æƒ³æ³•ä¹Ÿæ¬¢è¿éšæ—¶æPRã€‚  </p>
<h1 id="å…¶ä»–èµ„æº">å…¶ä»–èµ„æº</h1><p>æ–‡ç« å†…æ–‡ä»¶æä¾›å…¬å…±ä¸‹è½½<br>é…å›¾æ‰€ç”¨Sketchæ–‡ä»¶ï¼š<a href="/files/2015/11/SCCatWaitingHUD/MAO.sketch">ä¸‹è½½é“¾æ¥</a></p>
<h1 id="ä½œè€…">ä½œè€…</h1><p>Sergio Chan<br>Github : <a href="https://github.com/SergioChan" target="_blank" rel="external">https://github.com/SergioChan</a><br>Weibo : <a href="http://weibo.com/sergiochan" target="_blank" rel="external">http://weibo.com/sergiochan</a>  </p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è¿™ä¸ªåˆ›æ„å…¶å®æ¥æºäºå¾®åšä¸Š@ç”»æ¸£ç¨‹åºçŒ¿mmoaayè½¬å‘å¹¶è‰¾ç‰¹æˆ‘çš„çš„ä¸€ç»„gifå›¾<br>çœ‹åˆ°å›¾çš„æ—¶å€™ æˆ‘å…ˆå¯¹å›¾å¤§è‡´è¿›è¡Œäº†ç»“æ„å’Œå±‚æ¬¡çš„åŒºåˆ†<br>åœ¨è®¾è®¡ç‰©ä½“åŠ¨æ•ˆçš„æ—¶å€™ï¼Œé¦–å…ˆæ˜¯è¦å¯¹åŠ¨ç”»çš„ä¸åŒå¯¹è±¡è¿›è¡Œæ‹†åˆ†ï¼Œåœ¨è¿™é‡Œï¼Œè€é¼ ï¼ŒçŒ«çœ¼ç›ï¼Œçœ¼çš®ï¼Œä»¥åŠçŒ«è„¸ï¼Œä»–]]>
    </summary>
    
      <category term="ObjC" scheme="http://anius.io/tags/ObjC/"/>
    
      <category term="WaitingHUD" scheme="http://anius.io/tags/WaitingHUD/"/>
    
      <category term="ä»£ç " scheme="http://anius.io/categories/%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[tvOSè§†å·®æŒ‰é’®çš„ObjCå®ç°]]></title>
    <link href="http://anius.io/2015/11/18/tvOS%E8%A7%86%E5%B7%AE%E6%8C%89%E9%92%AE%E7%9A%84ObjC%E5%AE%9E%E7%8E%B0/"/>
    <id>http://anius.io/2015/11/18/tvOSè§†å·®æŒ‰é’®çš„ObjCå®ç°/</id>
    <published>2015-11-18T12:31:54.000Z</published>
    <updated>2015-11-25T14:10:58.000Z</updated>
    <content type="html"><![CDATA[<p><img src="/img/2015/11/tvOS/tvOSButtonPic_thumb.jpg" alt=""></p>
<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è‹¹æœåœ¨æœ€æ–°å‘å¸ƒçš„Apple TVé‡Œå¼•å…¥äº†æœ‰è¶£çš„<a href="https://developer.apple.com/tvos/human-interface-guidelines/icons-and-images/" target="_blank" rel="external">å›¾æ ‡è®¾è®¡</a><br>å…·ä½“è¯´æ¥ å›¾æ ‡ç”±2-5ä¸ªåˆ†å±‚å›¾å±‚æ„æˆ åœ¨å›¾æ ‡è¢«é€‰ä¸­çš„æ—¶å€™ å›¾æ ‡å†…æ¯ä¸ªå›¾å±‚è¿›è¡Œä¸åŒå¹…åº¦çš„ä½ç§» ä»è€Œå½¢æˆè§†è§‰ä¸Šå…·æœ‰æ·±åº¦è·ç¦»æ„Ÿçš„è§†å·®æ•ˆæœ å›¾æ ‡æ„æˆå’Œæ•ˆæœå¯ä»¥è§è§†é¢‘:  </p>
<p><video id="video" controls preload="none" autoplay loop><br>                                                <source src="https://developer.apple.com/tvos/human-interface-guidelines/icons-and-images/images/icons-and-images-layering.mp4" type="video/mp4"><br>                                                <source src="https://developer.apple.com/tvos/human-interface-guidelines/icons-and-images/images/icons-and-images-layering.ogv" type="video/ogg"><br>                                                <source src="https://developer.apple.com/tvos/human-interface-guidelines/icons-and-images/images/icons-and-images-layering.webm" type="video/webm"><br>                                            </video><br>è¿™ç§æ•ˆæœå¾ˆé€‚åˆç”¨äºå¤šåª’ä½“ç±»åº”ç”¨ ä¾‹å¦‚å›¾ä¹¦æˆ–è€…ç”µå½±å°é¢ è®©å°é¢å˜å¾—ç«‹ä½“ç”ŸåŠ¨ ç„¶è€Œè¿™ç§æ•ˆæœç›®å‰åªèƒ½åœ¨Apple TVçš„tvOSé‡Œè§åˆ°<br>æ‰€ä»¥ å¦‚ä½•åœ¨iOSä¸Šåšå‡ºåŒæ ·çš„æ•ˆæœå‘¢ï¼Ÿç°åœ¨å°±è®©æˆ‘ä»¬ä¸€èµ·ç ”ç©¶ä¸‹è§†å·®æŒ‰é’®çš„å®ç°åŸç† å¹¶ä¸”è‡ªå·±å®ç°ä¸€ä¸ªå§ ^_^  </p>
<h2 id="åŸç†">åŸç†</h2><p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†ä»¥ä¸‹å›¾ç‰‡ï¼šï¼ˆä½ å¯ä»¥ä»<a href="/files/2015/11/tvOS/tvOS-Gear.zip">ä¸‹è½½é“¾æ¥</a>ä¸‹è½½å·²ç»åˆ†å±‚çš„å››å¼ å›¾ç‰‡ï¼‰<br><img src="/img/2015/11/tvOS/tvOSButtonPic_1.jpg" alt="å››å¼ å·²ç»åˆ†å±‚çš„å›¾ç‰‡"><br>åŸºäºè¿™å››å¼ å›¾ç‰‡ æˆ‘ä»¬è¯¥æ€ä¹ˆå¯¹å…¶è¿›è¡Œå˜æ¢æ¥è¾¾åˆ°tvOSçš„è§†å·®æ•ˆæœå‘¢ï¼Ÿ<br>é‡æ–°è§‚å¯Ÿä¸Šæ–‡ä¸­è‹¹æœå®˜æ–¹çš„ä¾‹å­è§†é¢‘ æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š  </p>
<h3 id="1-_æ€»å›¾å±‚åœ¨æ—‹è½¬_ä½†ä¸åŒäºä¸€èˆ¬åœ¨å±å¹•å¹³é¢ä¸Šçš„æ—‹è½¬_è€Œæ˜¯ç›¸å¯¹å±å¹•å…·æœ‰ä¸€å®šå¤¹è§’çš„æ—‹è½¬">1. æ€»å›¾å±‚åœ¨æ—‹è½¬ ä½†ä¸åŒäºä¸€èˆ¬åœ¨å±å¹•å¹³é¢ä¸Šçš„æ—‹è½¬ è€Œæ˜¯ç›¸å¯¹å±å¹•å…·æœ‰ä¸€å®šå¤¹è§’çš„æ—‹è½¬</h3><p>å¦‚æœä¸å¤ªäº†è§£è¿™ç§æ—‹è½¬æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ æˆ‘ä»¬å¯ä»¥çœ‹ä¸€å¼ æœ‰å…³ CATransform3D çš„å›¾ï¼š<br><img src="/img/2015/11/tvOS/tvOSButtonPic_2.jpg" alt="CATransform3DMakeRotationçš„XYZè½´"><br>æˆ‘ä»¬å¸¸ç”¨çš„ CGRect æœ‰ X å’Œ Y ä¸¤ä¸ªä½ç½®å‚æ•° è€Œ CATransform3D å¯ä»¥ç†è§£ä¸ºåœ¨æ—¥å¸¸çš„ä¸¤ä¸ªè½´ä»¥å¤–åŠ äº† Z è½´ æ–¹å‘ä¸ºä»æ‰‹æœºä¸Šè¡¨é¢ç«–ç›´å‘ä¸‹ å¦‚å›¾<br>è¿™ä¹ˆä¸€æ¥ æˆ‘ä»¬æ—¥å¸¸æ‰€è§çš„åœ¨å±å¹•å¹³é¢ä¸Šçš„æ—‹è½¬ï¼ˆæ¯”å¦‚å±å¹•æ—‹è½¬ï¼‰å…¶å®æ˜¯ç»• Z è½´æ—‹è½¬<br>è€Œç»• X å’Œ Y è½´çš„æ—‹è½¬ ä¾¿æ˜¯è®© CALayer å…·æœ‰ç›¸å¯¹å±å¹•å…·æœ‰ä¸€å®šå¤¹è§’çš„æ—‹è½¬ å…·ä½“è¡¨ç°å°±æ˜¯å¦‚åŒtvOSæŒ‰é’®ä¸€æ ·æœ‰è¿œè¿‘æ•ˆæœï¼ˆå…¶å®åœ¨é€è§†æ•ˆæœä¸Šè¿˜æ˜¯æœ‰äº›ä¸ä¸€æ · åé¢ä¼šææ€ä¹ˆè§£å†³ï¼‰<br><code>CATransform3DMakeRotation</code> å°±æ˜¯è¿™ä¹ˆé€šè¿‡æ—‹è½¬è§’åº¦å®šä¹‰çš„ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DMakeRotation</span> (</span><br><span class="line">   <span class="built_in">CGFloat</span> angle, <span class="comment">//ç»•ç€å‘é‡(x,y,z)æ—‹è½¬çš„è§’åº¦</span></span><br><span class="line">   <span class="built_in">CGFloat</span> x, <span class="comment">//xè½´åˆ†é‡</span></span><br><span class="line">   <span class="built_in">CGFloat</span> y, <span class="comment">//yè½´åˆ†é‡</span></span><br><span class="line">   <span class="built_in">CGFloat</span> z <span class="comment">//zè½´åˆ†é‡</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<h3 id="2-é™¤å»æ—‹è½¬_æ¯ä¸ªå›¾å±‚éƒ½åœ¨è¿›è¡Œä¸åŒåŠå¾„çš„åœ†å‘¨ç§»åŠ¨">2.é™¤å»æ—‹è½¬ æ¯ä¸ªå›¾å±‚éƒ½åœ¨è¿›è¡Œä¸åŒåŠå¾„çš„åœ†å‘¨ç§»åŠ¨</h3><p>ä¸ºä»€ä¹ˆæœ‰ç§»åŠ¨ï¼Ÿ<br>é€è§†æ˜¯åˆ›é€ ä¸‰ç»´æ·±åº¦æ„Ÿè§‰çš„å…³é”® è€Œé€è§†æ•ˆæœæœ€ç›´ç™½çš„è¯æ¥è¯´ å°±æ˜¯â€œè¿‘å¤§è¿œå°â€<br>è®©æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­å§ :-)<br><img src="/img/2015/11/tvOS/tvOSButtonPic_3.jpg" alt="è¿‘å¤§è¿œå°çš„è¯´æ˜"><br>å¦‚æœåªæœ‰æ€»å›¾å±‚è‡ªè½¬ åˆ†å›¾å±‚ä¸è¿›è¡Œç§»åŠ¨ é‚£ä¹ˆæ•´ä¸ªæŒ‰é’®è™½ç„¶æœ‰è‡ªè½¬æ•ˆæœ ä½†æ˜¯çœ‹èµ·æ¥è¿˜æ˜¯å¹³çš„<br>å¦‚æœè¦ä¿è¯æœ‰ä¸‰ç»´æ•ˆæœ å°±è¦æœ‰è§†å·® å³è¿‘å¤§è¿œå° è®©<strong>è¿œå¤„çš„å›¾å±‚ç§»åŠ¨çš„è·ç¦»å¾ˆå° è¿‘å¤„çš„å›¾å±‚ç§»åŠ¨è·ç¦»å¾ˆå¤§</strong>ï¼ˆå¤§å®¶å¯ä»¥è‡ªè¡Œæƒ³è±¡åŒæ ·é€Ÿåº¦è¿œå¤„è¿‘å¤„çš„æ±½è½¦ çœ‹èµ·æ¥ç§»åŠ¨çš„è·ç¦»ä¹Ÿä¸ä¸€æ ·ï¼‰<br>å› æ­¤ å°±è¦ä»¤åˆ†å›¾å±‚è¿›è¡Œåœ†å‘¨ç§»åŠ¨ ç¦»æˆ‘ä»¬è¿‘çš„å›¾å±‚ åœ†å‘¨åŠå¾„è¦æ›´å¤§äº› ä¿è¯çœ‹èµ·æ¥ç§»åŠ¨çš„è·ç¦»æ›´å¤§<br>æˆ‘ä»¬ç®€å•åœ°ç”¨ Principle åšäº†ä¸€ä¸ª<a href="/files/2015/11/tvOS/tvOS_Principle_1.prd">åŸå‹</a> å¤§ä½“æ•ˆæœåº”è¯¥æ˜¯è¿™ä¸ªæ ·å­çš„ ä¸­é—´çš„åœ†ç‚¹æ˜¯ç§»åŠ¨çš„è½´å¿ƒ<br><img src="/img/2015/11/tvOS/tvOSButtonGif_1.gif" alt="ç®€é™‹çš„åœ†å‘¨ç§»åŠ¨æ•ˆæœ"></p>
<h3 id="3-æ€»çš„å›¾å±‚ä¹Ÿä¼šç§»åŠ¨">3.æ€»çš„å›¾å±‚ä¹Ÿä¼šç§»åŠ¨</h3><p>çœ‹åˆ°æˆ‘ä»¬åˆšæ‰é‚£ä¸ªç®€é™‹çš„æ•ˆæœäº†æ²¡ï¼Ÿä½ æœ‰å¯èƒ½ä¼šæƒ³ ä¸ºä»€ä¹ˆçœ‹èµ·æ¥å’ŒtvOSå·®åˆ«é‚£ä¹ˆå¤§ï¼Ÿ<br>åŸå› æ˜¯ tvOSå®ç°çš„æ•ˆæœ æ•´ä¸ªæŒ‰é’®å¹¶æ²¡æœ‰æ˜æ˜¾åœ°ç§»åŠ¨ è€Œæ˜¯è¿‘ä¼¼äºå›ºå®šåœ¨æŸä¸ªä½ç½®çš„ è¿™ä¹ˆä¸€æ¥ å°±è¦æ±‚æˆ‘ä»¬åœ¨åˆ†å›¾å±‚ç§»åŠ¨çš„æ—¶å€™ æ€»å›¾å±‚å åŠ ä¸€é¡¹åæ–¹å‘çš„ç§»åŠ¨ ä¿è¯æŒ‰é’®å›ºå®šä½<br>äºæ˜¯æˆ‘ä»¬åˆç”¨ Principle åšäº†ä¸€ä¸ª<a href="/files/2015/11/tvOS/tvOS_Principle_2.prd">åŸå‹</a> å¤§ä½“æ•ˆæœåº”è¯¥æ˜¯è¿™ä¸ªæ ·å­çš„<br><img src="/img/2015/11/tvOS/tvOSButtonGif_2.gif" alt="è¿˜æ˜¯å¾ˆç®€é™‹çš„åœ†å‘¨ç§»åŠ¨æ•ˆæœ">  </p>
<h3 id="4-é«˜å…‰çš„ç§»åŠ¨æ–¹å‘æ°å¥½ç›¸å">4.é«˜å…‰çš„ç§»åŠ¨æ–¹å‘æ°å¥½ç›¸å</h3><p>é«˜å…‰å°±æ˜¯æˆ‘ä»¬åœ¨tvOSçš„å›¾æ ‡ä¸Šçœ‹åˆ°çš„ç™½è‰²åå…‰ è¿™ä¸ªéƒ¨åˆ†å…¶å®å¾ˆç®€å•ï¼š<br>ç”¨PSç”»ä¸€ä¸ªç™½è‰²çš„åœ† åŠ ä¸Šæ¨¡ç³Šæ•ˆæœ å°±æ˜¯ä¸€ä¸ª é«˜å…‰å›¾å±‚<br>è®©å›¾å±‚åœ¨ç§»åŠ¨çš„æ—¶å€™äºå…¶ä»–å›¾å±‚æ–¹å‘ç›¸å å³è®©å›¾å±‚å åŠ ä¹‹åçš„æ•ˆæœä¸º é«˜å…‰æ°¸è¿œåœ¨ç¦»æˆ‘ä»¬æœ€è¿‘çš„åœ°æ–¹ è¿™é‡Œè¯´èµ·æ¥ä¼šæœ‰ç‚¹å›°æƒ‘ ä½†æ˜¯ç”¨ä»£ç å®ç°çš„æ—¶å€™å°±è‡ªç„¶æ˜ç™½äº† ^_^</p>
<h1 id="å®ç°">å®ç°</h1><blockquote>
<p>æ³¨ï¼šå®ç°éƒ¨åˆ†é™äºç¯‡å¹… ä¸å¯èƒ½å°†æ‰€æœ‰ä»£ç éƒ½ç²˜è´´å‡ºæ¥ åªæ˜¯åœ¨å‡ ä¸ªå…³é”®çš„åœ°æ–¹ç²˜è´´å‡ºæ¥åŠ ä»¥è¯´æ˜<br>å®Œæ•´ä»£ç è§ <a href="https://github.com/JustinFincher/JZtvOSParallaxButton" target="_blank" rel="external">https://github.com/JustinFincher/JZtvOSParallaxButton</a>  </p>
</blockquote>
<h3 id="1-æŒ‰é’®åŸºæœ¬">1.æŒ‰é’®åŸºæœ¬</h3><p>æŒ‰ç…§æˆ‘ä»¬çš„è®¡åˆ’ è¿™ä¸ªæŒ‰é’®é»˜è®¤å¹¶æ²¡æœ‰ä¸‰ç»´æ•ˆæœ å°±æ˜¯å¾ˆå¤šUIImageå åŠ èµ·æ¥ åªæœ‰å½“æˆ‘ä»¬é•¿æŒ‰çš„æ—¶å€™ æ‰ä¼šæœ‰å„ç§æ—‹è½¬å’Œç§»åŠ¨<br>è¿™é‡ŒåŠ¨ç”»æ–¹å¼åˆ†ä¸ºä¸¤ç§ ç¬¬ä¸€ç§æ˜¯è‡ªåŠ¨åŠ¨ç”» é¦–å…ˆä¼šç§»åŠ¨å’Œæ—‹è½¬åˆ°ä¸€ä¸ªç‰¹å®šçš„è§’åº¦ ç„¶åä¾¿å¼€å§‹å‘¨æœŸç§»åŠ¨äº† ç¬¬äºŒç§æ˜¯æ‰‹åŠ¨åŠ¨ç”» æŒ‰é’®ä¼šè·Ÿéšæ‰‹æŒ‡Dragè¿›è¡Œæ—‹è½¬å’Œç§»åŠ¨<br>è®©æˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ªUIButtonå§ :-)<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.h</span></span><br><span class="line"><span class="preprocessor"># import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, RotateMethodType)</span><br><span class="line">&#123;</span><br><span class="line">	RotateMethodTypeAutoRotate = <span class="number">0</span>, <span class="comment">//è‡ªåŠ¨åŠ¨ç”»</span></span><br><span class="line">	RotateMethodTypeWithFinger, <span class="comment">//è·Ÿéšæ‰‹æŒ‡</span></span><br><span class="line">	RotateMethodTypeWithFingerReverse, <span class="comment">//è·Ÿéšæ‰‹æŒ‡ ä½†åå‘</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JZParallaxButton</span> : <span class="title">UIButton</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.m</span></span><br><span class="line"><span class="preprocessor"># define LongPressInterval 0.5 //è‡ªåŠ¨åŠ¨ç”»çŠ¶æ€ä¸‹çš„é•¿æŒ‰åˆ¤æ–­æ—¶é—´</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIButton</span> ()&lt;<span class="title">UIGestureRecognizerDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JZParallaxButton</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>å†™ä¸€ä¸ªè‡ªå·±çš„initæ–¹æ³• ç„¶ååœ¨é‡Œé¢åŠ å…¥é•¿æŒ‰çš„æ‰‹åŠ¿åˆ¤æ–­<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.m</span></span><br><span class="line">- (instancetype)initButtonWith<span class="built_in">CGRect</span>:(<span class="built_in">CGRect</span>)RectInfo</span><br><span class="line">		              WithLayerArray:(<span class="built_in">NSMutableArray</span> *)ArrayOfLayer</span><br><span class="line">		      WithRoundCornerEnabled:(<span class="built_in">BOOL</span>)isRoundCorner</span><br><span class="line">		   WithCornerRadiusifEnabled:(<span class="built_in">CGFloat</span>)Radius</span><br><span class="line">		          WithRotationFrames:(<span class="keyword">int</span>)Frames</span><br><span class="line">		        WithRotationInterval:(<span class="built_in">CGFloat</span>)Interval</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:RectInfo];</span><br><span class="line">	</span><br><span class="line">	            <span class="comment">//...çœç•¥...</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">UILongPressGestureRecognizer</span> *longPress = [[<span class="built_in">UILongPressGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(selfLongPressed:)];</span><br><span class="line">	longPress<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">	longPress<span class="variable">.minimumPressDuration</span> = LongPressInterval;</span><br><span class="line">	<span class="comment">//selfå°±æ˜¯UIButtonäº† æ‰€ä»¥å¯ä»¥å¯¹self add</span></span><br><span class="line">	[<span class="keyword">self</span> addGestureRecognizer:longPress];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.m</span></span><br><span class="line"><span class="comment">//é•¿æŒ‰ä¼šè§¦å‘çš„æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)selfLongPressed:(<span class="built_in">UILongPressGestureRecognizer</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">CGPoint</span> PressedPoint = [sender locationInView:<span class="keyword">self</span>];</span><br><span class="line">	<span class="built_in">NSLog</span>(<span class="string">@"%F , %F"</span>,PressedPoint<span class="variable">.x</span>,PressedPoint<span class="variable">.y</span>);    </span><br><span class="line">	<span class="comment">//å¯ä»¥è¯»å–å½“å‰æŒ‰ä¸‹çš„ä½ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-å±‚çº§å…³ç³»å’Œé€»è¾‘åˆ¤æ–­">2.å±‚çº§å…³ç³»å’Œé€»è¾‘åˆ¤æ–­</h3><p>æˆ‘ä»¬çš„æŒ‰é’®åœ¨å®ç°ååº”æœ‰ä»¥ä¸‹å±‚çº§ï¼š<br><img src="/img/2015/11/tvOS/tvOSButtonPic_4.jpg" alt="å±‚çº§å…³ç³»"><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">ParallaxButton:</span>UIButton  <span class="comment">//æˆ‘ä»¬å»ºç«‹çš„UIButton SubClass</span></span><br><span class="line">|-<span class="string">BoundsView:</span>UIView   <span class="comment">//æ€»è§†å›¾ </span></span><br><span class="line">  |--<span class="string">LayerImageView1:</span>UIImageView <span class="comment">//åˆ†è§†å›¾ æ˜¯æ€»è§†å›¾çš„SubView</span></span><br><span class="line">  |--<span class="string">LayerImageView2:</span>UIImageView</span><br><span class="line">  |--<span class="string">LayerImageView3:</span>UIImageView</span><br><span class="line">  |--<span class="string">LayerImageView4:</span>UIImageView</span><br><span class="line">  |--<span class="string">LayerImageView5:</span>UIImageView</span><br><span class="line">  |-- .... </span><br><span class="line">  |--<span class="string">LayerImageViewX:</span>UIImageView</span><br></pre></td></tr></table></figure></p>
<p>æœ‰çš„åŒå­¦æœ‰å¯èƒ½ä¼šè§‰å¾— ä¸ºä»€ä¹ˆéœ€è¦æ€»è§†å›¾è¿™ä¸ª <code>BoundsView</code> å‘¢ ç›´æ¥å°†æ‰€æœ‰çš„UIImageViewéƒ½åˆ’å½’ä¸ºUIButtonçš„SubViewä¸å°±å¥½äº†ä¹ˆï¼Ÿ<br>å®éªŒè¿‡ç›´æ¥å°†UIImageViewæ·»åŠ åˆ°UIButtonä¸ºSubViewå æˆ‘æœ‰ä¸€ä¸ªç›¸å¯¹åˆç†çš„è§£é‡Šï¼š<br>æˆ‘ä»¬ä¹‹å‰åˆ†æåŸç†çš„æ—¶å€™ è¯´æ˜å…¶å®æ˜¯åªæœ‰æ€»å›¾å±‚ï¼ˆå³ <code>BoundsView</code> ï¼‰åœ¨æ—‹è½¬çš„ åˆ†å›¾å±‚åªéœ€å¤„ç†ç§»åŠ¨é—®é¢˜<br>å¦‚æœå»é™¤äº†æ€»å›¾å±‚ å°±åªèƒ½è®©æ¯ä¸ªåˆ†å›¾å±‚ï¼ˆå³ <code>LayerImageView</code> ï¼‰åœ¨ç§»åŠ¨çš„åŒæ—¶éƒ½æ—‹è½¬ è¿™åŠ¿å¿…å¸¦æ¥ä¸€ä¸ªé—®é¢˜ é‚£å°±æ˜¯ä¼šæœ‰â€œåšåº¦â€çš„æ„Ÿè§‰<br>è®©æˆ‘ä»¬å®éªŒä¸‹ å¦‚æœå±‚çº§å…³ç³»å¦‚ä¸‹å›¾ ä¼šæ˜¯ä»€ä¹ˆç»“æœ<br><img src="/img/2015/11/tvOS/tvOSButtonGif_3.gif" alt="é”™è¯¯çš„æ˜¾ç¤ºæ•ˆæœ"><br>å¯ä»¥çœ‹åˆ° è¿™é‡Œçš„å›¾å±‚ç§»åŠ¨æ–¹å¼å’ŒåŸå‹é‡Œçš„æ•ˆæœå·²ç»å¾ˆæ¥è¿‘äº† ä½†æ˜¯å› ä¸ºåˆ†å›¾å±‚ç§»åŠ¨åŠå¾„ä¸ä¸€ å¹¶ä¸”æ²¡æœ‰æ€»å›¾å±‚è¿›è¡Œçº¦æŸ å¯¼è‡´åˆ†å›¾å±‚çš„æ˜¾ç¤ºåŒºåŸŸä¸åœ¨ä¸€ä¸ªé•¿æ–¹å½¢é‡Œ çœ‹èµ·æ¥åƒæ˜¯æœ‰åšåº¦äº†ä¸€æ · æ•´ä¸ªæŒ‰é’®å®é™…çœ‹èµ·æ¥å¹¶æ²¡æœ‰tvOSæŒ‰é’®é‡Œçš„é‚£ç§è½»ç›ˆæ„Ÿ<br>å› æ­¤ éœ€è¦æœ‰æ€»å›¾å±‚è¿›è¡Œçº¦æŸ å³å°†åˆ†å›¾å±‚æ·»åŠ ä¸ºæ€»å›¾å±‚çš„SubView å¹¶è®¾ç½®æ€»å›¾å±‚Layerçš„MasksToBoundsä¸ºYES è¿™æ—¶ æ‰€æœ‰åˆ†å›¾å±‚çš„å¯è§åŒºåŸŸéƒ½å—é™åˆ¶äºæ€»å›¾å±‚ æ— è®ºæ€ä¹ˆæ—‹è½¬å’Œç§»åŠ¨éƒ½ä¸ä¼šå‡ºç°åšåº¦æ„Ÿäº†<br>æˆ‘ä»¬ç°åœ¨å°†è§†å›¾å±‚çº§éœ€è¦çš„ä¸€äº›å˜é‡å†™å‡ºæ¥ ç„¶åå†å®ç°ä¸€äº›é€»è¾‘åˆ¤æ–­çš„ä»£ç  æ¯”å¦‚é•¿æŒ‰åéœ€è¦åšä»€ä¹ˆ<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.h</span></span><br><span class="line"><span class="preprocessor"># import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, ParallaxMethodType)</span><br><span class="line">&#123;</span><br><span class="line">	ParallaxMethodTypeLinear = <span class="number">0</span>,</span><br><span class="line">	ParallaxMethodTypeEaseIn,</span><br><span class="line">	ParallaxMethodTypeEaseOut,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JZParallaxButton</span> : <span class="title">UIButton</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ•°ç»„ç”¨äºè®°å½•å½“å‰ButtonåŒ…å«çš„æ‰€æœ‰ImageLayer å³åˆ†å›¾å±‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> *LayerArray;</span><br><span class="line"></span><br><span class="line"><span class="comment">//buttonåœ†è§’</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> RoundCornerEnabled;</span><br><span class="line"></span><br><span class="line"><span class="comment">//buttonåœ†è§’</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> RoundCornerRadius;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¯å¦åœ¨Parallax</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> isParallax;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="keyword">int</span> RotationAllSteps;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> RotationInterval;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> ScaleBase;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGFloat</span> ScaleAddition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) ParallaxMethodType ParallaxMethod;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) RotateMethodType RotateMethod;</span><br><span class="line"></span><br><span class="line">- (instancetype)initButtonWith<span class="built_in">CGRect</span>:(<span class="built_in">CGRect</span>)RectInfo</span><br><span class="line">		              WithLayerArray:(<span class="built_in">NSMutableArray</span> *)ArrayOfLayer</span><br><span class="line">		      WithRoundCornerEnabled:(<span class="built_in">BOOL</span>)isRoundCorner</span><br><span class="line">		   WithCornerRadiusifEnabled:(<span class="built_in">CGFloat</span>)Radius</span><br><span class="line">		          WithRotationFrames:(<span class="keyword">int</span>)Frames</span><br><span class="line">		        WithRotationInterval:(<span class="built_in">CGFloat</span>)Interval;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.m</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># define RotateParameter 0.5 //ç”¨äºè°ƒæ•´æ—‹è½¬å¹…åº¦</span></span><br><span class="line"><span class="preprocessor"># define SpotlightOutRange 20.0f //ç”¨äºé«˜å…‰è·ç¦»ä¸­å¿ƒçš„é•¿åº¦</span></span><br><span class="line"><span class="preprocessor"># define zPositionMax 800 //Core Layerå˜æ¢æ—¶æ‘„åƒæœºé»˜è®¤zè½´ä½ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># define BoundsVieTranslation 50 //æ€»å›¾å±‚çš„ç§»åŠ¨å¹…åº¦</span></span><br><span class="line"><span class="preprocessor"># define LayerVieTranslation 20 //åˆ†å›¾å±‚çš„ç§»åŠ¨å¹…åº¦</span></span><br><span class="line"><span class="preprocessor"># define LongPressInterval 0.5 //è‡ªåŠ¨åŠ¨ç”»çŠ¶æ€ä¸‹çš„é•¿æŒ‰åˆ¤æ–­æ—¶é—´  </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIButton</span> ()&lt;<span class="title">UIGestureRecognizerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="keyword">int</span> RotationNowStep; <span class="comment">//è®°å½•åŠ¨ç”»çš„å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">weak</span>)<span class="built_in">NSTimer</span> *RotationTimer; <span class="comment">//åŠ¨ç”»è®¡æ—¶å™¨</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *SpotLightView;  <span class="comment">//é«˜å…‰å›¾å±‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">UIView</span> *BoundsView; <span class="comment">//æ€»å›¾å±‚</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">CGPoint</span> TouchPointInSelf; <span class="comment">//æ‰‹æŒ‡æŒ‰ä¸‹çš„æ—¶å€™åœ¨Buttonå†…éƒ¨ çš„ä½ç½® ç”¨äºButtonè®¾ä¸ºè·Ÿéšæ‰‹æŒ‡çš„æ—¶å€™</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasPreformedBeginAnimation; <span class="comment">//åˆ¤æ–­æ˜¯å¦åœ¨è¿›è¡ŒåŠ¨ç”» é˜²æ­¢åŠ¨ç”»æœªè¡¨æ¼”å®Œå°±è§¦å‘ä¸‹ä¸€ä¸ªåŠ¨ä½œ é€ æˆé”™ä½</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JZParallaxButton</span></span></span><br><span class="line"><span class="comment">//çœç•¥ @synthesize ...</span></span><br><span class="line"></span><br><span class="line">- (instancetype)initButtonWith<span class="built_in">CGRect</span>:(<span class="built_in">CGRect</span>)RectInfo</span><br><span class="line">                      WithLayerArray:(<span class="built_in">NSMutableArray</span> *)ArrayOfLayer</span><br><span class="line">              WithRoundCornerEnabled:(<span class="built_in">BOOL</span>)isRoundCorner</span><br><span class="line">           WithCornerRadiusifEnabled:(<span class="built_in">CGFloat</span>)Radius</span><br><span class="line">                  WithRotationFrames:(<span class="keyword">int</span>)Frames</span><br><span class="line">                WithRotationInterval:(<span class="built_in">CGFloat</span>)Interval</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//çœç•¥ä¹‹å‰çš„ä»£ç ....</span></span><br><span class="line">	LayerArray = [[<span class="built_in">NSMutableArray</span> alloc] initWithCapacity:[ArrayOfLayer count]];</span><br><span class="line">    </span><br><span class="line">    BoundsView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>)];</span><br><span class="line">    BoundsView<span class="variable">.layer</span><span class="variable">.masksToBounds</span> = <span class="literal">YES</span>;</span><br><span class="line">    BoundsView<span class="variable">.layer</span><span class="variable">.shouldRasterize</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    BoundsView<span class="variable">.layer</span><span class="variable">.rasterizationScale</span> = [[<span class="built_in">UIScreen</span> mainScreen] scale];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.RoundCornerEnabled</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        BoundsView<span class="variable">.layer</span><span class="variable">.cornerRadius</span> = <span class="keyword">self</span><span class="variable">.RoundCornerRadius</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> addSubview:BoundsView];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; [ArrayOfLayer count]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">UIImageView</span> *LayerImageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>)];</span><br><span class="line">        <span class="built_in">UIImage</span> *LayerImage = [ArrayOfLayer objectAtIndex:i];</span><br><span class="line">        [LayerImageView setImage:LayerImage];</span><br><span class="line">        LayerImageView<span class="variable">.layer</span><span class="variable">.shouldRasterize</span> = <span class="literal">TRUE</span>;</span><br><span class="line">        LayerImageView<span class="variable">.layer</span><span class="variable">.rasterizationScale</span> = [[<span class="built_in">UIScreen</span> mainScreen] scale];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä»ä¸‹å¾€ä¸Šæ·»åŠ </span></span><br><span class="line">        [BoundsView addSubview:LayerImageView];</span><br><span class="line">        [LayerArray addObject:LayerImageView];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¦‚æœæŠŠæ‰€æœ‰åˆ†å›¾å±‚éƒ½åŠ å®Œäº†</span></span><br><span class="line">        <span class="keyword">if</span> (i == [ArrayOfLayer count] - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//åœ¨æœ€ä¸Šå±‚æ·»åŠ é«˜å…‰åˆ†å›¾å±‚</span></span><br><span class="line">            SpotLightView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width</span>,<span class="keyword">self</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.height</span>)];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">NSString</span> *bundlePath = [[<span class="built_in">NSBundle</span> bundleForClass:[JZParallaxButton class]]</span><br><span class="line">                                    pathForResource:<span class="string">@"JZParallaxButton"</span> ofType:<span class="string">@"bundle"</span>];</span><br><span class="line">            <span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleWithPath:bundlePath];</span><br><span class="line">            </span><br><span class="line">            SpotLightView<span class="variable">.image</span> = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"Spotlight"</span> inBundle:bundle compatibleWithTraitCollection:<span class="literal">nil</span>];</span><br><span class="line">            SpotLightView<span class="variable">.contentMode</span> = <span class="built_in">UIViewContentModeScaleAspectFit</span>;</span><br><span class="line">            SpotLightView<span class="variable">.layer</span><span class="variable">.masksToBounds</span> = <span class="literal">YES</span>;</span><br><span class="line">            [BoundsView addSubview:SpotLightView];</span><br><span class="line">            SpotLightView<span class="variable">.layer</span><span class="variable">.zPosition</span> = zPositionMax;</span><br><span class="line">            [<span class="keyword">self</span> bringSubviewToFront:SpotLightView];</span><br><span class="line">            SpotLightView<span class="variable">.alpha</span> = <span class="number">0.0</span>;</span><br><span class="line">            [LayerArray addObject:SpotLightView];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;              </span><br><span class="line">- (<span class="keyword">void</span>)selfLongPressed:(<span class="built_in">UILongPressGestureRecognizer</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">CGPoint</span> PressedPoint = [sender locationInView:<span class="keyword">self</span>];</span><br><span class="line">	<span class="comment">//NSLog(@"%F , %F",PressedPoint.x,PressedPoint.y);</span></span><br><span class="line">	<span class="keyword">self</span><span class="variable">.TouchPointInSelf</span> = PressedPoint;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(sender<span class="variable">.state</span> == <span class="built_in">UIGestureRecognizerStateBegan</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="comment">//NSLog(@"Long Press");</span></span><br><span class="line">	    <span class="keyword">self</span><span class="variable">.hasPreformedBeginAnimation</span> = <span class="literal">NO</span>;</span><br><span class="line">	</span><br><span class="line">	    <span class="keyword">switch</span> (<span class="keyword">self</span><span class="variable">.RotateMethod</span>)</span><br><span class="line">	    &#123;</span><br><span class="line">	        <span class="keyword">case</span> RotateMethodTypeAutoRotate:</span><br><span class="line">	        &#123;</span><br><span class="line">	        <span class="comment">//é•¿æŒ‰å å¦‚æœåœ¨è¿›è¡Œè§†å·®æ•ˆæœå°±ç»“æŸ å¦‚æœç°åœ¨æ˜¯æ™®é€šçŠ¶æ€å°±å¼€å¯è§†å·®æ•ˆæœ</span></span><br><span class="line">	            <span class="keyword">if</span> (isParallax)</span><br><span class="line">	            &#123;</span><br><span class="line">	                [<span class="keyword">self</span> EndParallax];</span><br><span class="line">	            &#125;</span><br><span class="line">	            <span class="keyword">else</span></span><br><span class="line">	            &#123;</span><br><span class="line">	                [<span class="keyword">self</span> BeginParallax];</span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125;</span><br><span class="line">	            <span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	        <span class="keyword">case</span> RotateMethodTypeWithFinger:</span><br><span class="line">	        &#123;</span><br><span class="line">	        <span class="comment">//æ‰‹åŠ¨åŠ¨ç”»ç»“æŸè§†å·®æ•ˆæœå¹¶ä¸ä¾é é•¿æŒ‰ è€Œæ˜¯é€šè¿‡åˆ¤æ–­æ‰‹æŒ‡æ˜¯å¦ç•™åœ¨å±å¹•ä¸Š</span></span><br><span class="line">	            <span class="keyword">if</span> (!isParallax)</span><br><span class="line">	            &#123;</span><br><span class="line">	                [<span class="keyword">self</span> BeginParallax];</span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125;</span><br><span class="line">	            <span class="keyword">break</span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (sender<span class="variable">.state</span> == <span class="built_in">UIGestureRecognizerStateEnded</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//å¦‚æœé•¿æŒ‰ç»“æŸä½†ä»æœ‰åŠ¨ç”»åœ¨è¿›è¡Œ å°±ç­‰å¾… LongPressInterval å†æ‰§è¡ŒTouchUpæ–¹æ³• å¦åˆ™ç«‹å³æ‰§è¡ŒTouchUp</span></span><br><span class="line">	    <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.hasPreformedBeginAnimation</span> == <span class="literal">NO</span>)</span><br><span class="line">	    &#123;</span><br><span class="line">	        [<span class="keyword">self</span> performSelector:<span class="keyword">@selector</span>(TouchUp) withObject:<span class="keyword">self</span> afterDelay:LongPressInterval ];</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="keyword">else</span></span><br><span class="line">	    &#123;</span><br><span class="line">	        [<span class="keyword">self</span> TouchUp];</span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>shouldRasterize</code> ï¼š<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">property</span> BOOL shouldRasterize</span><br><span class="line">Description	A Boolean <span class="keyword">that</span> indicates whether <span class="keyword">the</span> layer <span class="keyword">is</span> rendered <span class="keyword">as</span> a bitmap <span class="keyword">before</span> compositing. Animatable</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æŸäº›æ—¶å€™ ä¾‹å¦‚å¯¼å…¥çš„å›¾ç‰‡åˆ†è¾¨ç‡è¾ƒå¤§ æ­¤æ—¶å¯¹UIImageViewè¿›è¡ŒCAåŠ¨ç”» ä¼šå‡ºç°é”¯é½¿ è¿™ä¸ªæ—¶å€™ å¯ä»¥é€šè¿‡è®¾ç½® <code>shouldRasterize</code> æ¥è§£å†³<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BoundsView.layer.shouldRasterize </span>= YES<span class="comment">;</span></span><br><span class="line"><span class="keyword">BoundsView.layer.rasterizationScale </span>= [[UIScreen mainScreen] scale]<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>å½“ç„¶è®¾ç½® <code>allowsEdgeAntialiasing</code> ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³• è¿™é‡Œæˆ‘ä»¬å¯¹æ¯”ä¸‹ å¯ä»¥æ³¨æ„çœ‹å³è¾¹å¢™å£ä¸Šçš„æ ‘å½± é€šè¿‡ <code>shouldRasterize</code> è®¾ç½®å åŸºæœ¬ä¸Šå½±å­ä¸ä¼šå‡ºç°è¾ƒå¤§çš„å˜åŠ¨ï¼š<br><img src="/img/2015/11/tvOS/tvOSButtonGif_4.gif" alt="ä¸¤ç§æŠ—é”¯é½¿çš„å¯¹æ¯”"></p>
<h3 id="3-é€è§†æ•ˆæœéœ€è¦å®ç°çš„ä¸€ä¸ªæ–¹æ³•">3.é€è§†æ•ˆæœéœ€è¦å®ç°çš„ä¸€ä¸ªæ–¹æ³•</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JZParallaxButton.m</span></span><br><span class="line"><span class="comment">//CATransform3DMake é»˜è®¤ç»™å‡ºçš„CATransform3Dæ˜¯æ²¡æœ‰é€è§†æ•ˆæœçš„ éœ€è¦æ‰‹åŠ¨åŠ å…¥è¿™ä¸€æ®µ å®Œæˆä» orthographic åˆ° perspective çš„æ”¹å˜</span></span><br><span class="line"><span class="comment">//è¿™ä¸ªæ–¹æ³•çš„è§£æå¯ä»¥çœ‹ http://wonderffee.github.io/blog/2013/10/19/an-analysis-for-transform-samples-of-calayer/</span></span><br><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DMakePerspective</span>(<span class="built_in">CGPoint</span> center, <span class="keyword">float</span> disZ)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CATransform3D</span> transToCenter = <span class="built_in">CATransform3DMakeTranslation</span>(-center<span class="variable">.x</span>, -center<span class="variable">.y</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">CATransform3D</span> transBack = <span class="built_in">CATransform3DMakeTranslation</span>(center<span class="variable">.x</span>, center<span class="variable">.y</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">CATransform3D</span> scale = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line">scale<span class="variable">.m34</span> = -<span class="number">1.0</span>f/disZ;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">CATransform3DConcat</span>(<span class="built_in">CATransform3DConcat</span>(transToCenter, scale), transBack);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">CATransform3D</span> <span class="built_in">CATransform3DPerspect</span>(<span class="built_in">CATransform3D</span> t, <span class="built_in">CGPoint</span> center, <span class="keyword">float</span> disZ)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">CATransform3DConcat</span>(t, <span class="built_in">CATransform3DMakePerspective</span>(center, disZ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-å®ç°è‡ªåŠ¨åŠ¨ç”»">4.å®ç°è‡ªåŠ¨åŠ¨ç”»</h3><p>è¿™éƒ¨åˆ†ä¸»è¦å†…å®¹å°±æ˜¯ åœ¨é•¿æŒ‰å æŒ‰é’®ä¼šå…ˆè¿›å…¥æŸä¸ªç‰¹å®šçš„è§’åº¦ä½ç½® ç„¶åè¿›è¡Œè‡ªè½¬<br>è¿™é‡Œä¸ºäº†ç®€å• ä½¿ç”¨äº†NSTimerè¿›è¡Œæ¯ä¸€å¸§çš„è®¡æ•° ä½†éœ€è¦æ³¨æ„çš„æ˜¯ NSTimerçš„ç²¾åº¦ä¸è¶³ä»¥å®ŒæˆçœŸæ­£æµç•…çš„åŠ¨ç”»<br>è‡ªåŠ¨åŠ¨ç”»é‡Œ æ€»å›¾å±‚å’Œåˆ†å›¾å±‚çš„ç§»åŠ¨ æ—‹è½¬éƒ½å’Œä¸¤ä¸ªå‚æ•°æœ‰å…³ï¼šä¸€æ˜¯å½“å‰çš„è®¡æ•°ä½ç½®ï¼ˆå³Stepï¼‰ è€Œæ˜¯å›¾å±‚åœ¨æ€»æŒ‰é’®é‡Œçš„å±‚çº§ä½ç½®(å³LayerArrayé‡Œçš„i) é€šè¿‡è¿™ä¸¤ä¸ªå‚æ•°è¿›è¡Œè®¡ç®—CATransform3D<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  JZParallaxButton.m</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#define OutTranslationParameter  (float)([LayerArray count] + i)/(float)([LayerArray count] * 2)</span></span><br><span class="line"><span class="preprocessor">#define OutScaleParameter  ScaleBase+ScaleAddition/5*((float)i/(float)([LayerArray count]))</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JZParallaxButton</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)BeginAutoRotation</span><br><span class="line">&#123;</span><br><span class="line">    __<span class="keyword">weak</span> JZParallaxButton *weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="comment">//éœ€è¦åˆ°è¾¾åŠ¨ç”»çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> PIE = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> Degress = M_PI*<span class="number">2</span>*PIE;</span><br><span class="line">    <span class="comment">//NSlog(@"Degress : %f PIE",PIE);</span></span><br><span class="line">    <span class="built_in">CGFloat</span> Sin = sin(Degress)/<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> Cos = cos(Degress)/<span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i =<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//è®¡ç®—åˆå§‹ä½ç½®çš„æ—‹è½¬ ç§»åŠ¨ å’Œç¼©æ”¾</span></span><br><span class="line">    <span class="built_in">CATransform3D</span> NewRotate,NewTranslation,NewScale;</span><br><span class="line">    NewRotate = <span class="built_in">CATransform3DConcat</span>(<span class="built_in">CATransform3DMakeRotation</span>(-Sin*RotateParameter, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), <span class="built_in">CATransform3DMakeRotation</span>(Cos*RotateParameter, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    NewTranslation = <span class="built_in">CATransform3DMakeTranslation</span>(Sin*BoundsVieTranslation*OutTranslationParameter, Cos*BoundsVieTranslation*OutTranslationParameter, <span class="number">0</span>);</span><br><span class="line">    NewScale = <span class="built_in">CATransform3DMakeScale</span>(OutScaleParameter, OutScaleParameter, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä½¿ç”¨CATransform3DConcatå°†ä¸‰ä¸ªCATransform3Dç»“åˆæˆä¸€ä¸ªCATransform3D</span></span><br><span class="line">    <span class="built_in">CATransform3D</span> TwoTransform = <span class="built_in">CATransform3DConcat</span>(NewRotate,NewTranslation);</span><br><span class="line">    <span class="built_in">CATransform3D</span> AllTransform = <span class="built_in">CATransform3DConcat</span>(TwoTransform,NewScale);</span><br><span class="line">    <span class="comment">//å¯¹BoundsLayer å³æ€»å›¾å±‚è¿›è¡ŒåŠ¨ç”»</span></span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *BoundsLayer<span class="built_in">CABasicAnimation</span> = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.duration</span> = <span class="number">0.4</span>f;</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.autoreverses</span> = <span class="literal">NO</span>;</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:<span class="built_in">CATransform3DPerspect</span>(AllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax)];</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.fromValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:BoundsView<span class="variable">.layer</span><span class="variable">.transform</span>];</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.fillMode</span> = k<span class="built_in">CAFillModeBoth</span>;</span><br><span class="line">    BoundsLayer<span class="built_in">CABasicAnimation</span><span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">    [BoundsView<span class="variable">.layer</span> addAnimation:BoundsLayer<span class="built_in">CABasicAnimation</span> forKey:<span class="string">@"BoundsLayerCABasicAnimation"</span>];</span><br><span class="line">    BoundsView<span class="variable">.layer</span><span class="variable">.transform</span> = <span class="built_in">CATransform3DPerspect</span>(AllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¯¹LayerArrayå†…çš„UIImageView å³åˆ†å›¾å±‚è¿›è¡ŒåŠ¨ç”»</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; [LayerArray count]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¯¹äºä¸åŒçš„å‰åä½ç½® éœ€è¦ç§»åŠ¨çš„åŠå¾„ä¸ä¸€æ ·</span></span><br><span class="line">        <span class="keyword">float</span> InTranslationParameter = [<span class="keyword">self</span> InTranslationParameterWithLayerArray:LayerArray WithIndex:i];</span><br><span class="line">        <span class="keyword">float</span> InScaleParameter = [<span class="keyword">self</span> InScaleParameterWithLayerArray:LayerArray WithIndex:i];</span><br><span class="line">        <span class="built_in">UIImageView</span> *LayerImageView = [LayerArray objectAtIndex:i];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">CATransform3D</span> NewTranslation ;</span><br><span class="line">        <span class="built_in">CATransform3D</span> NewScale = <span class="built_in">CATransform3DMakeScale</span>(InScaleParameter, InScaleParameter, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (i == [LayerArray count] - <span class="number">1</span>) <span class="comment">//æ˜¯é«˜å…‰æ‰€åœ¨çš„View</span></span><br><span class="line">        &#123;</span><br><span class="line">            NewTranslation = <span class="built_in">CATransform3DMakeTranslation</span>(Sin*LayerVieTranslation*InTranslationParameter*SpotlightOutRange, Cos*LayerVieTranslation*InTranslationParameter*SpotlightOutRange, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//åˆ†å›¾å±‚å…¶ä»–çš„View æ³¨æ„å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ Translation å’Œé«˜å…‰æ˜¯ç›¸åçš„</span></span><br><span class="line">        &#123;</span><br><span class="line">            NewTranslation = <span class="built_in">CATransform3DMakeTranslation</span>(-Sin*LayerVieTranslation*InTranslationParameter, -Cos*LayerVieTranslation*InTranslationParameter, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CATransform3D</span> NewAllTransform = <span class="built_in">CATransform3DConcat</span>(NewTranslation,NewScale);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CABasicAnimation</span> *LayerImageView<span class="built_in">CABasicAnimation</span> = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"transform"</span>];</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.duration</span> = <span class="number">0.4</span>f;</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.autoreverses</span> = <span class="literal">NO</span>;</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:NewAllTransform];</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.fromValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CATransform3D</span>:LayerImageView<span class="variable">.layer</span><span class="variable">.transform</span>];</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.fillMode</span> = k<span class="built_in">CAFillModeBoth</span>;</span><br><span class="line">        LayerImageView<span class="built_in">CABasicAnimation</span><span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CAAnimationGroup</span> *animGroup = [<span class="built_in">CAAnimationGroup</span> animation];</span><br><span class="line">        animGroup<span class="variable">.animations</span> = [<span class="built_in">NSArray</span> arrayWithObjects:LayerImageView<span class="built_in">CABasicAnimation</span>,<span class="literal">nil</span>];</span><br><span class="line">        animGroup<span class="variable">.duration</span> = <span class="number">0.4</span>f;</span><br><span class="line">        animGroup<span class="variable">.removedOnCompletion</span> = <span class="literal">YES</span>;</span><br><span class="line">        animGroup<span class="variable">.autoreverses</span> = <span class="literal">NO</span>;</span><br><span class="line">        animGroup<span class="variable">.fillMode</span> = k<span class="built_in">CAFillModeRemoved</span>;</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">CATransaction</span> begin];</span><br><span class="line">        LayerImageView<span class="variable">.layer</span><span class="variable">.transform</span> = <span class="built_in">CATransform3DPerspect</span>(NewAllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax);</span><br><span class="line">        [<span class="built_in">CATransaction</span> setCompletionBlock:^</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="keyword">if</span> (i == [LayerArray count] - <span class="number">1</span>)</span><br><span class="line">             &#123;</span><br><span class="line">                 <span class="comment">//ç®€å•çš„å‘¨æœŸå¾ªç¯</span></span><br><span class="line">                 RotationNowStep = <span class="number">0</span>;</span><br><span class="line">                 RotationTimer =  [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:RotationInterval/RotationAllSteps target:weakSelf selector:<span class="keyword">@selector</span>(RotationCreator) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">                 weakSelf<span class="variable">.hasPreformedBeginAnimation</span> = <span class="literal">YES</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;];</span><br><span class="line">        [LayerImageView<span class="variable">.layer</span> addAnimation:animGroup forKey:<span class="string">@"LayerImageViewParallaxInitAnimation"</span>];</span><br><span class="line">        [<span class="built_in">CATransaction</span> commit];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¡æ—¶å™¨æ¯æ¬¡è§¦å‘è¦æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)RotationCreator</span><br><span class="line">&#123;</span><br><span class="line">    __<span class="keyword">weak</span> JZParallaxButton *weakSelf = <span class="keyword">self</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//NSlog(@"RotationNowStep : %d of %d",RotationNowStep,RotationAllSteps);</span></span><br><span class="line">    <span class="keyword">if</span> (RotationNowStep == RotationAllSteps)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//ä¸€å‘¨å®Œæˆ è®¡æ•°å™¨ç½®1</span></span><br><span class="line">        RotationNowStep = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        RotationNowStep ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> PIE = (<span class="keyword">float</span>)RotationNowStep/(<span class="keyword">float</span>)RotationAllSteps;</span><br><span class="line">    <span class="built_in">CGFloat</span> Degress = M_PI*<span class="number">2</span>*PIE;</span><br><span class="line">    <span class="comment">//NSlog(@"Degress : %f PIE",PIE);</span></span><br><span class="line">    <span class="built_in">CGFloat</span> Sin = sin(Degress)/<span class="number">4</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> Cos = cos(Degress)/<span class="number">4</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CATransform3D</span> NewRotate,NewTranslation,NewScale;</span><br><span class="line">    NewRotate = <span class="built_in">CATransform3DConcat</span>(<span class="built_in">CATransform3DMakeRotation</span>(-Sin*RotateParameter, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>), <span class="built_in">CATransform3DMakeRotation</span>(Cos*RotateParameter, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">    NewTranslation = <span class="built_in">CATransform3DMakeTranslation</span>(Sin*BoundsVieTranslation*OutTranslationParameter, Cos*BoundsVieTranslation*OutTranslationParameter, <span class="number">0</span>);</span><br><span class="line">    NewScale = <span class="built_in">CATransform3DMakeScale</span>(OutScaleParameter, OutScaleParameter, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CATransform3D</span> TwoTransform = <span class="built_in">CATransform3DConcat</span>(NewRotate,NewTranslation);</span><br><span class="line">    <span class="built_in">CATransform3D</span> AllTransform = <span class="built_in">CATransform3DConcat</span>(TwoTransform,NewScale);</span><br><span class="line">    BoundsView<span class="variable">.layer</span><span class="variable">.transform</span> = <span class="built_in">CATransform3DPerspect</span>(AllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; [LayerArray count]; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">float</span> InScaleParameter = [<span class="keyword">self</span> InScaleParameterWithLayerArray:LayerArray WithIndex:i];</span><br><span class="line">        <span class="keyword">float</span> InTranslationParameter = [<span class="keyword">self</span> InTranslationParameterWithLayerArray:LayerArray WithIndex:i];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (i == [LayerArray count] - <span class="number">1</span>) <span class="comment">//is spotlight</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">UIImageView</span> *LayerImageView = [weakSelf<span class="variable">.LayerArray</span> objectAtIndex:i];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CATransform3D</span> Translation = <span class="built_in">CATransform3DMakeTranslation</span>(Sin*LayerVieTranslation*InTranslationParameter*SpotlightOutRange, Cos*LayerVieTranslation*InTranslationParameter*SpotlightOutRange,<span class="number">0</span>);</span><br><span class="line">            <span class="built_in">CATransform3D</span> Scale = <span class="built_in">CATransform3DMakeScale</span>(InScaleParameter, InScaleParameter, <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">CATransform3D</span> AllTransform = <span class="built_in">CATransform3DConcat</span>(Translation,Scale);</span><br><span class="line">            </span><br><span class="line">            LayerImageView<span class="variable">.layer</span><span class="variable">.transform</span> = <span class="built_in">CATransform3DPerspect</span>(AllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//is Parallax layer</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">UIImageView</span> *LayerImageView = [weakSelf<span class="variable">.LayerArray</span> objectAtIndex:i];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">CATransform3D</span> Translation = <span class="built_in">CATransform3DMakeTranslation</span>(-Sin*LayerVieTranslation*InTranslationParameter, -Cos*LayerVieTranslation*InTranslationParameter, <span class="number">0</span>);</span><br><span class="line">            <span class="built_in">CATransform3D</span> Scale = <span class="built_in">CATransform3DMakeScale</span>(InScaleParameter, InScaleParameter, <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">CATransform3D</span> AllTransform = <span class="built_in">CATransform3DConcat</span>(Translation,Scale);</span><br><span class="line">            </span><br><span class="line">            LayerImageView<span class="variable">.layer</span><span class="variable">.transform</span> = <span class="built_in">CATransform3DPerspect</span>(AllTransform, <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>), zPositionMax);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">float</span>)InTranslationParameterWithLayerArray:(<span class="built_in">NSMutableArray</span> *)Array</span><br><span class="line">                                    WithIndex:(<span class="keyword">int</span>)i</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (ParallaxMethod)</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="comment">//ç§»åŠ¨åŠå¾„å’Œå›¾å±‚å±‚çº§æˆçº¿æ€§å…³ç³»</span></span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeLinear:</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">float</span>)(i)/(<span class="keyword">float</span>)([Array count]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//ç§»åŠ¨åŠå¾„å’Œå›¾å±‚å±‚çº§æˆäºŒæ¬¡å…³ç³»</span></span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeEaseIn:</span><br><span class="line">            <span class="keyword">return</span> powf((<span class="keyword">float</span>)(i)/(<span class="keyword">float</span>)([Array count]), <span class="number">0.5</span>f);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    	<span class="comment">//ç§»åŠ¨åŠå¾„å’Œå›¾å±‚å±‚çº§æˆæ ¹å·å…³ç³»</span></span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeEaseOut:</span><br><span class="line">            <span class="keyword">return</span> powf((<span class="keyword">float</span>)(i)/(<span class="keyword">float</span>)([Array count]), <span class="number">2.0</span>f);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">float</span>)(i)/(<span class="keyword">float</span>)([Array count]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">float</span>)InScaleParameterWithLayerArray:(<span class="built_in">NSMutableArray</span> *)Array</span><br><span class="line">                                    WithIndex:(<span class="keyword">int</span>)i</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span> (ParallaxMethod)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">//ç¼©æ”¾ä¸å›¾å±‚å±‚çº§çš„ä¸åŒå…³ç³»</span></span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeLinear:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+ScaleAddition/<span class="number">10</span>*((<span class="keyword">float</span>)i/(<span class="keyword">float</span>)([LayerArray count]));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeEaseIn:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+ScaleAddition/<span class="number">10</span>*powf(((<span class="keyword">float</span>)i/(<span class="keyword">float</span>)([LayerArray count])), <span class="number">0.5</span>f);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">case</span> ParallaxMethodTypeEaseOut:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+ScaleAddition/<span class="number">10</span>*powf(((<span class="keyword">float</span>)i/(<span class="keyword">float</span>)([LayerArray count])), <span class="number">2.0</span>f);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>+ScaleAddition/<span class="number">10</span>*((<span class="keyword">float</span>)i/(<span class="keyword">float</span>)([LayerArray count]));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-å®ç°æ‰‹åŠ¨åŠ¨ç”»">4.å®ç°æ‰‹åŠ¨åŠ¨ç”»</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰‹åŠ¨åŠ¨ç”»å’Œè‡ªåŠ¨åŠ¨ç”»çš„åŒºåˆ«æ˜¯ ç§»åŠ¨çš„è§’åº¦ä¸å†è·Ÿè¿›è®¡æ•°å™¨è®¡ç®— è€Œæ˜¯ç›´æ¥è¯»å–æ‰‹æŒ‡çš„CGPoint</span></span><br><span class="line">__weak JZParallaxButton *weakSelf = self;</span><br><span class="line">    CGFloat XOffest;</span><br><span class="line">    <span class="keyword">if</span> (TouchPointInSelf.x &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        XOffest = - weakSelf.frame.<span class="built_in">size</span>.<span class="variable">width</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (TouchPointInSelf.x &gt; weakSelf.frame.<span class="built_in">size</span>.<span class="variable">width</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        XOffest = weakSelf.frame.<span class="built_in">size</span>.<span class="variable">width</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        XOffest = TouchPointInSelf.x - weakSelf.frame.<span class="built_in">size</span>.<span class="variable">width</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    CGFloat YOffest;</span><br><span class="line">    <span class="keyword">if</span> (TouchPointInSelf.y &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        YOffest = - weakSelf.frame.<span class="built_in">size</span>.<span class="variable">height</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (TouchPointInSelf.y &gt; weakSelf.frame.<span class="built_in">size</span>.<span class="variable">height</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        YOffest = weakSelf.frame.<span class="built_in">size</span>.<span class="variable">height</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        YOffest = TouchPointInSelf.y - weakSelf.frame.<span class="built_in">size</span>.<span class="variable">height</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//NSLog(@"XOffest : %f , YOffest : %f",XOffest,YOffest);</span></span><br><span class="line">    </span><br><span class="line">    CGFloat XDegress = XOffest / weakSelf.frame.<span class="built_in">size</span>.<span class="variable">width</span> / <span class="number">2</span>;</span><br><span class="line">    CGFloat YDegress = YOffest / weakSelf.frame.<span class="built_in">size</span>.<span class="variable">height</span> / <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//NSLog(@"XDegress : %f , YDegress : %f",XDegress,YDegress);</span></span><br></pre></td></tr></table></figure>
<h1 id="æ•ˆæœ">æ•ˆæœ</h1><p>æ­¤æ—¶è¿˜æœ‰å¾ˆå¤šæ–¹æ³•æ²¡æœ‰å®ç°ï¼ˆæ¯”å¦‚åŠ¨ç”»ç»“æŸåéœ€è¦å˜å›åŸæœ‰çš„éä¸‰ç»´æ•ˆæœï¼‰ ä¸è¿‡å¤§ä½“ä¸Šå·²ç»å¯ä»¥çœ‹åˆ°æ•ˆæœäº† ä½ ä¹Ÿå¯ä»¥ç›´æ¥å°†å®Œæˆç‰ˆçš„<a href="https://github.com/JustinFincher/JZtvOSParallaxButton" target="_blank" rel="external">è§†å·®æŒ‰é’®ä¸‹è½½ä¸‹æ¥</a><br>Have Fun :-)</p>
<h1 id="å…¶ä»–èµ„æº">å…¶ä»–èµ„æº</h1><p>å¦‚æœä½ å¯¹çœŸæ­£ä¸‰ç»´çŠ¶æ€ä¸‹çš„æŒ‰é’®è¿˜æ˜¯ä¸å¤ªç†è§£ å¯ä»¥ç‚¹å‡»ä¸‹é¢çš„æ’­æ”¾æŒ‰é’®è‡ªç”±æŸ¥çœ‹è¿™ä¸ªä¸‰ç»´æ¨¡å‹ ç‚¹å‡»æ’­æ”¾æŒ‰é’®å é€šè¿‡ä¸‰ç»´åœºæ™¯å³ä¸‹è§’çš„å·¦å³åˆ‡æ¢æŸ¥çœ‹æŒ‰é’®çš„ä¸åŒæ—‹è½¬çŠ¶æ€ æˆ–è€…ç‚¹å‡»æ•°å­—1-5æ¥å¿«é€Ÿè·³è½¬  </p>
<iframe width="640" height="480" src="https://sketchfab.com/models/899bdd009cc64af0b2260fe7570a0510/embed" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>

<p>ä»¥å¤– è¿™ç¯‡æ–‡ç« é‡Œæ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æä¾›å…¬å…±ä¸‹è½½çš„<br>é…å›¾æ‰€ç”¨Sketchæ–‡ä»¶ï¼š<a href="/files/2015/11/tvOS/tvOS_Sketch.sketch">ä¸‹è½½é“¾æ¥</a><br>ä¸‰ç»´æ¨¡å‹æ–‡ä»¶ï¼ˆè¿›å…¥ç‚¹å‡»Downloadï¼‰ï¼š<a href="https://sketchfab.com/models/899bdd009cc64af0b2260fe7570a0510" target="_blank" rel="external">ä¸‹è½½é“¾æ¥</a>  </p>
<h1 id="ä½œè€…">ä½œè€…</h1><p>JustZht<br>Github : <a href="https://github.com/JustinFincher" target="_blank" rel="external">https://github.com/JustinFincher</a><br>Weibo : <a href="http://weibo.com/justzht" target="_blank" rel="external">http://weibo.com/justzht</a>  </p>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="/img/2015/11/tvOS/tvOSButtonPic_thumb.jpg" alt=""></p>
<h1 id="ä»‹ç»">ä»‹ç»</h1><p>è‹¹æœåœ¨æœ€æ–°å‘å¸ƒçš„Apple TVé‡Œå¼•å…¥äº†æœ‰è¶£çš„<a href="https://developer.]]>
    </summary>
    
      <category term="ObjC" scheme="http://anius.io/tags/ObjC/"/>
    
      <category term="tvOS" scheme="http://anius.io/tags/tvOS/"/>
    
      <category term="ä»£ç " scheme="http://anius.io/categories/%E4%BB%A3%E7%A0%81/"/>
    
  </entry>
  
</feed>
